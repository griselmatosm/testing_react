{"ast":null,"code":"/*\r\nAuthor: Geraint Luff and others\r\nYear: 2013\r\n\r\nThis code is released into the \"public domain\" by its author(s).  Anybody may use, alter and distribute the code without restriction.  The author makes no guarantees, and takes no liability of any kind for use of this code.\r\n\r\nIf you find a bug or make an improvement, it would be courteous to let the author know, but it is not compulsory.\r\n*/\n(function (global, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], factory);\n  } else if (typeof module !== 'undefined' && module.exports) {\n    // CommonJS. Define export.\n    module.exports = factory();\n  } else {\n    // Browser globals\n    global.tv4 = factory();\n  }\n})(this, function () {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FObject%2Fkeys\n  if (!Object.keys) {\n    Object.keys = function () {\n      var hasOwnProperty = Object.prototype.hasOwnProperty,\n          hasDontEnumBug = !{\n        toString: null\n      }.propertyIsEnumerable('toString'),\n          dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor'],\n          dontEnumsLength = dontEnums.length;\n      return function (obj) {\n        if (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\n          throw new TypeError('Object.keys called on non-object');\n        }\n\n        var result = [];\n\n        for (var prop in obj) {\n          if (hasOwnProperty.call(obj, prop)) {\n            result.push(prop);\n          }\n        }\n\n        if (hasDontEnumBug) {\n          for (var i = 0; i < dontEnumsLength; i++) {\n            if (hasOwnProperty.call(obj, dontEnums[i])) {\n              result.push(dontEnums[i]);\n            }\n          }\n        }\n\n        return result;\n      };\n    }();\n  } // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\n\n\n  if (!Object.create) {\n    Object.create = function () {\n      function F() {}\n\n      return function (o) {\n        if (arguments.length !== 1) {\n          throw new Error('Object.create implementation only accepts one parameter.');\n        }\n\n        F.prototype = o;\n        return new F();\n      };\n    }();\n  } // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FisArray\n\n\n  if (!Array.isArray) {\n    Array.isArray = function (vArg) {\n      return Object.prototype.toString.call(vArg) === \"[object Array]\";\n    };\n  } // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FindexOf\n\n\n  if (!Array.prototype.indexOf) {\n    Array.prototype.indexOf = function (searchElement\n    /*, fromIndex */\n    ) {\n      if (this === null) {\n        throw new TypeError();\n      }\n\n      var t = Object(this);\n      var len = t.length >>> 0;\n\n      if (len === 0) {\n        return -1;\n      }\n\n      var n = 0;\n\n      if (arguments.length > 1) {\n        n = Number(arguments[1]);\n\n        if (n !== n) {\n          // shortcut for verifying if it's NaN\n          n = 0;\n        } else if (n !== 0 && n !== Infinity && n !== -Infinity) {\n          n = (n > 0 || -1) * Math.floor(Math.abs(n));\n        }\n      }\n\n      if (n >= len) {\n        return -1;\n      }\n\n      var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\n\n      for (; k < len; k++) {\n        if (k in t && t[k] === searchElement) {\n          return k;\n        }\n      }\n\n      return -1;\n    };\n  } // Grungey Object.isFrozen hack\n\n\n  if (!Object.isFrozen) {\n    Object.isFrozen = function (obj) {\n      var key = \"tv4_test_frozen_key\";\n\n      while (obj.hasOwnProperty(key)) {\n        key += Math.random();\n      }\n\n      try {\n        obj[key] = true;\n        delete obj[key];\n        return false;\n      } catch (e) {\n        return true;\n      }\n    };\n  } // Based on: https://github.com/geraintluff/uri-templates, but with all the de-substitution stuff removed\n\n\n  var uriTemplateGlobalModifiers = {\n    \"+\": true,\n    \"#\": true,\n    \".\": true,\n    \"/\": true,\n    \";\": true,\n    \"?\": true,\n    \"&\": true\n  };\n  var uriTemplateSuffices = {\n    \"*\": true\n  };\n\n  function notReallyPercentEncode(string) {\n    return encodeURI(string).replace(/%25[0-9][0-9]/g, function (doubleEncoded) {\n      return \"%\" + doubleEncoded.substring(3);\n    });\n  }\n\n  function uriTemplateSubstitution(spec) {\n    var modifier = \"\";\n\n    if (uriTemplateGlobalModifiers[spec.charAt(0)]) {\n      modifier = spec.charAt(0);\n      spec = spec.substring(1);\n    }\n\n    var separator = \"\";\n    var prefix = \"\";\n    var shouldEscape = true;\n    var showVariables = false;\n    var trimEmptyString = false;\n\n    if (modifier === '+') {\n      shouldEscape = false;\n    } else if (modifier === \".\") {\n      prefix = \".\";\n      separator = \".\";\n    } else if (modifier === \"/\") {\n      prefix = \"/\";\n      separator = \"/\";\n    } else if (modifier === '#') {\n      prefix = \"#\";\n      shouldEscape = false;\n    } else if (modifier === ';') {\n      prefix = \";\";\n      separator = \";\";\n      showVariables = true;\n      trimEmptyString = true;\n    } else if (modifier === '?') {\n      prefix = \"?\";\n      separator = \"&\";\n      showVariables = true;\n    } else if (modifier === '&') {\n      prefix = \"&\";\n      separator = \"&\";\n      showVariables = true;\n    }\n\n    var varNames = [];\n    var varList = spec.split(\",\");\n    var varSpecs = [];\n    var varSpecMap = {};\n\n    for (var i = 0; i < varList.length; i++) {\n      var varName = varList[i];\n      var truncate = null;\n\n      if (varName.indexOf(\":\") !== -1) {\n        var parts = varName.split(\":\");\n        varName = parts[0];\n        truncate = parseInt(parts[1], 10);\n      }\n\n      var suffices = {};\n\n      while (uriTemplateSuffices[varName.charAt(varName.length - 1)]) {\n        suffices[varName.charAt(varName.length - 1)] = true;\n        varName = varName.substring(0, varName.length - 1);\n      }\n\n      var varSpec = {\n        truncate: truncate,\n        name: varName,\n        suffices: suffices\n      };\n      varSpecs.push(varSpec);\n      varSpecMap[varName] = varSpec;\n      varNames.push(varName);\n    }\n\n    var subFunction = function (valueFunction) {\n      var result = \"\";\n      var startIndex = 0;\n\n      for (var i = 0; i < varSpecs.length; i++) {\n        var varSpec = varSpecs[i];\n        var value = valueFunction(varSpec.name);\n\n        if (value === null || value === undefined || Array.isArray(value) && value.length === 0 || typeof value === 'object' && Object.keys(value).length === 0) {\n          startIndex++;\n          continue;\n        }\n\n        if (i === startIndex) {\n          result += prefix;\n        } else {\n          result += separator || \",\";\n        }\n\n        if (Array.isArray(value)) {\n          if (showVariables) {\n            result += varSpec.name + \"=\";\n          }\n\n          for (var j = 0; j < value.length; j++) {\n            if (j > 0) {\n              result += varSpec.suffices['*'] ? separator || \",\" : \",\";\n\n              if (varSpec.suffices['*'] && showVariables) {\n                result += varSpec.name + \"=\";\n              }\n            }\n\n            result += shouldEscape ? encodeURIComponent(value[j]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[j]);\n          }\n        } else if (typeof value === \"object\") {\n          if (showVariables && !varSpec.suffices['*']) {\n            result += varSpec.name + \"=\";\n          }\n\n          var first = true;\n\n          for (var key in value) {\n            if (!first) {\n              result += varSpec.suffices['*'] ? separator || \",\" : \",\";\n            }\n\n            first = false;\n            result += shouldEscape ? encodeURIComponent(key).replace(/!/g, \"%21\") : notReallyPercentEncode(key);\n            result += varSpec.suffices['*'] ? '=' : \",\";\n            result += shouldEscape ? encodeURIComponent(value[key]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[key]);\n          }\n        } else {\n          if (showVariables) {\n            result += varSpec.name;\n\n            if (!trimEmptyString || value !== \"\") {\n              result += \"=\";\n            }\n          }\n\n          if (varSpec.truncate != null) {\n            value = value.substring(0, varSpec.truncate);\n          }\n\n          result += shouldEscape ? encodeURIComponent(value).replace(/!/g, \"%21\") : notReallyPercentEncode(value);\n        }\n      }\n\n      return result;\n    };\n\n    subFunction.varNames = varNames;\n    return {\n      prefix: prefix,\n      substitution: subFunction\n    };\n  }\n\n  function UriTemplate(template) {\n    if (!(this instanceof UriTemplate)) {\n      return new UriTemplate(template);\n    }\n\n    var parts = template.split(\"{\");\n    var textParts = [parts.shift()];\n    var prefixes = [];\n    var substitutions = [];\n    var varNames = [];\n\n    while (parts.length > 0) {\n      var part = parts.shift();\n      var spec = part.split(\"}\")[0];\n      var remainder = part.substring(spec.length + 1);\n      var funcs = uriTemplateSubstitution(spec);\n      substitutions.push(funcs.substitution);\n      prefixes.push(funcs.prefix);\n      textParts.push(remainder);\n      varNames = varNames.concat(funcs.substitution.varNames);\n    }\n\n    this.fill = function (valueFunction) {\n      var result = textParts[0];\n\n      for (var i = 0; i < substitutions.length; i++) {\n        var substitution = substitutions[i];\n        result += substitution(valueFunction);\n        result += textParts[i + 1];\n      }\n\n      return result;\n    };\n\n    this.varNames = varNames;\n    this.template = template;\n  }\n\n  UriTemplate.prototype = {\n    toString: function () {\n      return this.template;\n    },\n    fillFromObject: function (obj) {\n      return this.fill(function (varName) {\n        return obj[varName];\n      });\n    }\n  };\n\n  var ValidatorContext = function ValidatorContext(parent, collectMultiple, errorReporter, checkRecursive, trackUnknownProperties) {\n    this.missing = [];\n    this.missingMap = {};\n    this.formatValidators = parent ? Object.create(parent.formatValidators) : {};\n    this.schemas = parent ? Object.create(parent.schemas) : {};\n    this.collectMultiple = collectMultiple;\n    this.errors = [];\n    this.handleError = collectMultiple ? this.collectError : this.returnError;\n\n    if (checkRecursive) {\n      this.checkRecursive = true;\n      this.scanned = [];\n      this.scannedFrozen = [];\n      this.scannedFrozenSchemas = [];\n      this.scannedFrozenValidationErrors = [];\n      this.validatedSchemasKey = 'tv4_validation_id';\n      this.validationErrorsKey = 'tv4_validation_errors_id';\n    }\n\n    if (trackUnknownProperties) {\n      this.trackUnknownProperties = true;\n      this.knownPropertyPaths = {};\n      this.unknownPropertyPaths = {};\n    }\n\n    this.errorReporter = errorReporter || defaultErrorReporter('en');\n\n    if (typeof this.errorReporter === 'string') {\n      throw new Error('debug');\n    }\n\n    this.definedKeywords = {};\n\n    if (parent) {\n      for (var key in parent.definedKeywords) {\n        this.definedKeywords[key] = parent.definedKeywords[key].slice(0);\n      }\n    }\n  };\n\n  ValidatorContext.prototype.defineKeyword = function (keyword, keywordFunction) {\n    this.definedKeywords[keyword] = this.definedKeywords[keyword] || [];\n    this.definedKeywords[keyword].push(keywordFunction);\n  };\n\n  ValidatorContext.prototype.createError = function (code, messageParams, dataPath, schemaPath, subErrors, data, schema) {\n    var error = new ValidationError(code, messageParams, dataPath, schemaPath, subErrors);\n    error.message = this.errorReporter(error, data, schema);\n    return error;\n  };\n\n  ValidatorContext.prototype.returnError = function (error) {\n    return error;\n  };\n\n  ValidatorContext.prototype.collectError = function (error) {\n    if (error) {\n      this.errors.push(error);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.prefixErrors = function (startIndex, dataPath, schemaPath) {\n    for (var i = startIndex; i < this.errors.length; i++) {\n      this.errors[i] = this.errors[i].prefixWith(dataPath, schemaPath);\n    }\n\n    return this;\n  };\n\n  ValidatorContext.prototype.banUnknownProperties = function (data, schema) {\n    for (var unknownPath in this.unknownPropertyPaths) {\n      var error = this.createError(ErrorCodes.UNKNOWN_PROPERTY, {\n        path: unknownPath\n      }, unknownPath, \"\", null, data, schema);\n      var result = this.handleError(error);\n\n      if (result) {\n        return result;\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.addFormat = function (format, validator) {\n    if (typeof format === 'object') {\n      for (var key in format) {\n        this.addFormat(key, format[key]);\n      }\n\n      return this;\n    }\n\n    this.formatValidators[format] = validator;\n  };\n\n  ValidatorContext.prototype.resolveRefs = function (schema, urlHistory) {\n    if (schema['$ref'] !== undefined) {\n      urlHistory = urlHistory || {};\n\n      if (urlHistory[schema['$ref']]) {\n        return this.createError(ErrorCodes.CIRCULAR_REFERENCE, {\n          urls: Object.keys(urlHistory).join(', ')\n        }, '', '', null, undefined, schema);\n      }\n\n      urlHistory[schema['$ref']] = true;\n      schema = this.getSchema(schema['$ref'], urlHistory);\n    }\n\n    return schema;\n  };\n\n  ValidatorContext.prototype.getSchema = function (url, urlHistory) {\n    var schema;\n\n    if (this.schemas[url] !== undefined) {\n      schema = this.schemas[url];\n      return this.resolveRefs(schema, urlHistory);\n    }\n\n    var baseUrl = url;\n    var fragment = \"\";\n\n    if (url.indexOf('#') !== -1) {\n      fragment = url.substring(url.indexOf(\"#\") + 1);\n      baseUrl = url.substring(0, url.indexOf(\"#\"));\n    }\n\n    if (typeof this.schemas[baseUrl] === 'object') {\n      schema = this.schemas[baseUrl];\n      var pointerPath = decodeURIComponent(fragment);\n\n      if (pointerPath === \"\") {\n        return this.resolveRefs(schema, urlHistory);\n      } else if (pointerPath.charAt(0) !== \"/\") {\n        return undefined;\n      }\n\n      var parts = pointerPath.split(\"/\").slice(1);\n\n      for (var i = 0; i < parts.length; i++) {\n        var component = parts[i].replace(/~1/g, \"/\").replace(/~0/g, \"~\");\n\n        if (schema[component] === undefined) {\n          schema = undefined;\n          break;\n        }\n\n        schema = schema[component];\n      }\n\n      if (schema !== undefined) {\n        return this.resolveRefs(schema, urlHistory);\n      }\n    }\n\n    if (this.missing[baseUrl] === undefined) {\n      this.missing.push(baseUrl);\n      this.missing[baseUrl] = baseUrl;\n      this.missingMap[baseUrl] = baseUrl;\n    }\n  };\n\n  ValidatorContext.prototype.searchSchemas = function (schema, url) {\n    if (Array.isArray(schema)) {\n      for (var i = 0; i < schema.length; i++) {\n        this.searchSchemas(schema[i], url);\n      }\n    } else if (schema && typeof schema === \"object\") {\n      if (typeof schema.id === \"string\") {\n        if (isTrustedUrl(url, schema.id)) {\n          if (this.schemas[schema.id] === undefined) {\n            this.schemas[schema.id] = schema;\n          }\n        }\n      }\n\n      for (var key in schema) {\n        if (key !== \"enum\") {\n          if (typeof schema[key] === \"object\") {\n            this.searchSchemas(schema[key], url);\n          } else if (key === \"$ref\") {\n            var uri = getDocumentUri(schema[key]);\n\n            if (uri && this.schemas[uri] === undefined && this.missingMap[uri] === undefined) {\n              this.missingMap[uri] = uri;\n            }\n          }\n        }\n      }\n    }\n  };\n\n  ValidatorContext.prototype.addSchema = function (url, schema) {\n    //overload\n    if (typeof url !== 'string' || typeof schema === 'undefined') {\n      if (typeof url === 'object' && typeof url.id === 'string') {\n        schema = url;\n        url = schema.id;\n      } else {\n        return;\n      }\n    }\n\n    if (url === getDocumentUri(url) + \"#\") {\n      // Remove empty fragment\n      url = getDocumentUri(url);\n    }\n\n    this.schemas[url] = schema;\n    delete this.missingMap[url];\n    normSchema(schema, url);\n    this.searchSchemas(schema, url);\n  };\n\n  ValidatorContext.prototype.getSchemaMap = function () {\n    var map = {};\n\n    for (var key in this.schemas) {\n      map[key] = this.schemas[key];\n    }\n\n    return map;\n  };\n\n  ValidatorContext.prototype.getSchemaUris = function (filterRegExp) {\n    var list = [];\n\n    for (var key in this.schemas) {\n      if (!filterRegExp || filterRegExp.test(key)) {\n        list.push(key);\n      }\n    }\n\n    return list;\n  };\n\n  ValidatorContext.prototype.getMissingUris = function (filterRegExp) {\n    var list = [];\n\n    for (var key in this.missingMap) {\n      if (!filterRegExp || filterRegExp.test(key)) {\n        list.push(key);\n      }\n    }\n\n    return list;\n  };\n\n  ValidatorContext.prototype.dropSchemas = function () {\n    this.schemas = {};\n    this.reset();\n  };\n\n  ValidatorContext.prototype.reset = function () {\n    this.missing = [];\n    this.missingMap = {};\n    this.errors = [];\n  };\n\n  ValidatorContext.prototype.validateAll = function (data, schema, dataPathParts, schemaPathParts, dataPointerPath) {\n    var topLevel;\n    schema = this.resolveRefs(schema);\n\n    if (!schema) {\n      return null;\n    } else if (schema instanceof ValidationError) {\n      this.errors.push(schema);\n      return schema;\n    }\n\n    var startErrorCount = this.errors.length;\n    var frozenIndex,\n        scannedFrozenSchemaIndex = null,\n        scannedSchemasIndex = null;\n\n    if (this.checkRecursive && data && typeof data === 'object') {\n      topLevel = !this.scanned.length;\n\n      if (data[this.validatedSchemasKey]) {\n        var schemaIndex = data[this.validatedSchemasKey].indexOf(schema);\n\n        if (schemaIndex !== -1) {\n          this.errors = this.errors.concat(data[this.validationErrorsKey][schemaIndex]);\n          return null;\n        }\n      }\n\n      if (Object.isFrozen(data)) {\n        frozenIndex = this.scannedFrozen.indexOf(data);\n\n        if (frozenIndex !== -1) {\n          var frozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].indexOf(schema);\n\n          if (frozenSchemaIndex !== -1) {\n            this.errors = this.errors.concat(this.scannedFrozenValidationErrors[frozenIndex][frozenSchemaIndex]);\n            return null;\n          }\n        }\n      }\n\n      this.scanned.push(data);\n\n      if (Object.isFrozen(data)) {\n        if (frozenIndex === -1) {\n          frozenIndex = this.scannedFrozen.length;\n          this.scannedFrozen.push(data);\n          this.scannedFrozenSchemas.push([]);\n        }\n\n        scannedFrozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].length;\n        this.scannedFrozenSchemas[frozenIndex][scannedFrozenSchemaIndex] = schema;\n        this.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = [];\n      } else {\n        if (!data[this.validatedSchemasKey]) {\n          try {\n            Object.defineProperty(data, this.validatedSchemasKey, {\n              value: [],\n              configurable: true\n            });\n            Object.defineProperty(data, this.validationErrorsKey, {\n              value: [],\n              configurable: true\n            });\n          } catch (e) {\n            //IE 7/8 workaround\n            data[this.validatedSchemasKey] = [];\n            data[this.validationErrorsKey] = [];\n          }\n        }\n\n        scannedSchemasIndex = data[this.validatedSchemasKey].length;\n        data[this.validatedSchemasKey][scannedSchemasIndex] = schema;\n        data[this.validationErrorsKey][scannedSchemasIndex] = [];\n      }\n    }\n\n    var errorCount = this.errors.length;\n    var error = this.validateBasic(data, schema, dataPointerPath) || this.validateNumeric(data, schema, dataPointerPath) || this.validateString(data, schema, dataPointerPath) || this.validateArray(data, schema, dataPointerPath) || this.validateObject(data, schema, dataPointerPath) || this.validateCombinations(data, schema, dataPointerPath) || this.validateHypermedia(data, schema, dataPointerPath) || this.validateFormat(data, schema, dataPointerPath) || this.validateDefinedKeywords(data, schema, dataPointerPath) || null;\n\n    if (topLevel) {\n      while (this.scanned.length) {\n        var item = this.scanned.pop();\n        delete item[this.validatedSchemasKey];\n      }\n\n      this.scannedFrozen = [];\n      this.scannedFrozenSchemas = [];\n    }\n\n    if (error || errorCount !== this.errors.length) {\n      while (dataPathParts && dataPathParts.length || schemaPathParts && schemaPathParts.length) {\n        var dataPart = dataPathParts && dataPathParts.length ? \"\" + dataPathParts.pop() : null;\n        var schemaPart = schemaPathParts && schemaPathParts.length ? \"\" + schemaPathParts.pop() : null;\n\n        if (error) {\n          error = error.prefixWith(dataPart, schemaPart);\n        }\n\n        this.prefixErrors(errorCount, dataPart, schemaPart);\n      }\n    }\n\n    if (scannedFrozenSchemaIndex !== null) {\n      this.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = this.errors.slice(startErrorCount);\n    } else if (scannedSchemasIndex !== null) {\n      data[this.validationErrorsKey][scannedSchemasIndex] = this.errors.slice(startErrorCount);\n    }\n\n    return this.handleError(error);\n  };\n\n  ValidatorContext.prototype.validateFormat = function (data, schema) {\n    if (typeof schema.format !== 'string' || !this.formatValidators[schema.format]) {\n      return null;\n    }\n\n    var errorMessage = this.formatValidators[schema.format].call(null, data, schema);\n\n    if (typeof errorMessage === 'string' || typeof errorMessage === 'number') {\n      return this.createError(ErrorCodes.FORMAT_CUSTOM, {\n        message: errorMessage\n      }, '', '/format', null, data, schema);\n    } else if (errorMessage && typeof errorMessage === 'object') {\n      return this.createError(ErrorCodes.FORMAT_CUSTOM, {\n        message: errorMessage.message || \"?\"\n      }, errorMessage.dataPath || '', errorMessage.schemaPath || \"/format\", null, data, schema);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateDefinedKeywords = function (data, schema, dataPointerPath) {\n    for (var key in this.definedKeywords) {\n      if (typeof schema[key] === 'undefined') {\n        continue;\n      }\n\n      var validationFunctions = this.definedKeywords[key];\n\n      for (var i = 0; i < validationFunctions.length; i++) {\n        var func = validationFunctions[i];\n        var result = func(data, schema[key], schema, dataPointerPath);\n\n        if (typeof result === 'string' || typeof result === 'number') {\n          return this.createError(ErrorCodes.KEYWORD_CUSTOM, {\n            key: key,\n            message: result\n          }, '', '', null, data, schema).prefixWith(null, key);\n        } else if (result && typeof result === 'object') {\n          var code = result.code;\n\n          if (typeof code === 'string') {\n            if (!ErrorCodes[code]) {\n              throw new Error('Undefined error code (use defineError): ' + code);\n            }\n\n            code = ErrorCodes[code];\n          } else if (typeof code !== 'number') {\n            code = ErrorCodes.KEYWORD_CUSTOM;\n          }\n\n          var messageParams = typeof result.message === 'object' ? result.message : {\n            key: key,\n            message: result.message || \"?\"\n          };\n          var schemaPath = result.schemaPath || \"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1');\n          return this.createError(code, messageParams, result.dataPath || null, schemaPath, null, data, schema);\n        }\n      }\n    }\n\n    return null;\n  };\n\n  function recursiveCompare(A, B) {\n    if (A === B) {\n      return true;\n    }\n\n    if (A && B && typeof A === \"object\" && typeof B === \"object\") {\n      if (Array.isArray(A) !== Array.isArray(B)) {\n        return false;\n      } else if (Array.isArray(A)) {\n        if (A.length !== B.length) {\n          return false;\n        }\n\n        for (var i = 0; i < A.length; i++) {\n          if (!recursiveCompare(A[i], B[i])) {\n            return false;\n          }\n        }\n      } else {\n        var key;\n\n        for (key in A) {\n          if (B[key] === undefined && A[key] !== undefined) {\n            return false;\n          }\n        }\n\n        for (key in B) {\n          if (A[key] === undefined && B[key] !== undefined) {\n            return false;\n          }\n        }\n\n        for (key in A) {\n          if (!recursiveCompare(A[key], B[key])) {\n            return false;\n          }\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  ValidatorContext.prototype.validateBasic = function validateBasic(data, schema, dataPointerPath) {\n    var error;\n\n    if (error = this.validateType(data, schema, dataPointerPath)) {\n      return error.prefixWith(null, \"type\");\n    }\n\n    if (error = this.validateEnum(data, schema, dataPointerPath)) {\n      return error.prefixWith(null, \"type\");\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateType = function validateType(data, schema) {\n    if (schema.type === undefined) {\n      return null;\n    }\n\n    var dataType = typeof data;\n\n    if (data === null) {\n      dataType = \"null\";\n    } else if (Array.isArray(data)) {\n      dataType = \"array\";\n    }\n\n    var allowedTypes = schema.type;\n\n    if (!Array.isArray(allowedTypes)) {\n      allowedTypes = [allowedTypes];\n    }\n\n    for (var i = 0; i < allowedTypes.length; i++) {\n      var type = allowedTypes[i];\n\n      if (type === dataType || type === \"integer\" && dataType === \"number\" && data % 1 === 0) {\n        return null;\n      }\n    }\n\n    return this.createError(ErrorCodes.INVALID_TYPE, {\n      type: dataType,\n      expected: allowedTypes.join(\"/\")\n    }, '', '', null, data, schema);\n  };\n\n  ValidatorContext.prototype.validateEnum = function validateEnum(data, schema) {\n    if (schema[\"enum\"] === undefined) {\n      return null;\n    }\n\n    for (var i = 0; i < schema[\"enum\"].length; i++) {\n      var enumVal = schema[\"enum\"][i];\n\n      if (recursiveCompare(data, enumVal)) {\n        return null;\n      }\n    }\n\n    return this.createError(ErrorCodes.ENUM_MISMATCH, {\n      value: typeof JSON !== 'undefined' ? JSON.stringify(data) : data\n    }, '', '', null, data, schema);\n  };\n\n  ValidatorContext.prototype.validateNumeric = function validateNumeric(data, schema, dataPointerPath) {\n    return this.validateMultipleOf(data, schema, dataPointerPath) || this.validateMinMax(data, schema, dataPointerPath) || this.validateNaN(data, schema, dataPointerPath) || null;\n  };\n\n  var CLOSE_ENOUGH_LOW = Math.pow(2, -51);\n  var CLOSE_ENOUGH_HIGH = 1 - CLOSE_ENOUGH_LOW;\n\n  ValidatorContext.prototype.validateMultipleOf = function validateMultipleOf(data, schema) {\n    var multipleOf = schema.multipleOf || schema.divisibleBy;\n\n    if (multipleOf === undefined) {\n      return null;\n    }\n\n    if (typeof data === \"number\") {\n      var remainder = data / multipleOf % 1;\n\n      if (remainder >= CLOSE_ENOUGH_LOW && remainder < CLOSE_ENOUGH_HIGH) {\n        return this.createError(ErrorCodes.NUMBER_MULTIPLE_OF, {\n          value: data,\n          multipleOf: multipleOf\n        }, '', '', null, data, schema);\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateMinMax = function validateMinMax(data, schema) {\n    if (typeof data !== \"number\") {\n      return null;\n    }\n\n    if (schema.minimum !== undefined) {\n      if (data < schema.minimum) {\n        return this.createError(ErrorCodes.NUMBER_MINIMUM, {\n          value: data,\n          minimum: schema.minimum\n        }, '', '/minimum', null, data, schema);\n      }\n\n      if (schema.exclusiveMinimum && data === schema.minimum) {\n        return this.createError(ErrorCodes.NUMBER_MINIMUM_EXCLUSIVE, {\n          value: data,\n          minimum: schema.minimum\n        }, '', '/exclusiveMinimum', null, data, schema);\n      }\n    }\n\n    if (schema.maximum !== undefined) {\n      if (data > schema.maximum) {\n        return this.createError(ErrorCodes.NUMBER_MAXIMUM, {\n          value: data,\n          maximum: schema.maximum\n        }, '', '/maximum', null, data, schema);\n      }\n\n      if (schema.exclusiveMaximum && data === schema.maximum) {\n        return this.createError(ErrorCodes.NUMBER_MAXIMUM_EXCLUSIVE, {\n          value: data,\n          maximum: schema.maximum\n        }, '', '/exclusiveMaximum', null, data, schema);\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateNaN = function validateNaN(data, schema) {\n    if (typeof data !== \"number\") {\n      return null;\n    }\n\n    if (isNaN(data) === true || data === Infinity || data === -Infinity) {\n      return this.createError(ErrorCodes.NUMBER_NOT_A_NUMBER, {\n        value: data\n      }, '', '/type', null, data, schema);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateString = function validateString(data, schema, dataPointerPath) {\n    return this.validateStringLength(data, schema, dataPointerPath) || this.validateStringPattern(data, schema, dataPointerPath) || null;\n  };\n\n  ValidatorContext.prototype.validateStringLength = function validateStringLength(data, schema) {\n    if (typeof data !== \"string\") {\n      return null;\n    }\n\n    if (schema.minLength !== undefined) {\n      if (data.length < schema.minLength) {\n        return this.createError(ErrorCodes.STRING_LENGTH_SHORT, {\n          length: data.length,\n          minimum: schema.minLength\n        }, '', '/minLength', null, data, schema);\n      }\n    }\n\n    if (schema.maxLength !== undefined) {\n      if (data.length > schema.maxLength) {\n        return this.createError(ErrorCodes.STRING_LENGTH_LONG, {\n          length: data.length,\n          maximum: schema.maxLength\n        }, '', '/maxLength', null, data, schema);\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateStringPattern = function validateStringPattern(data, schema) {\n    if (typeof data !== \"string\" || typeof schema.pattern !== \"string\" && !(schema.pattern instanceof RegExp)) {\n      return null;\n    }\n\n    var regexp;\n\n    if (schema.pattern instanceof RegExp) {\n      regexp = schema.pattern;\n    } else {\n      var body,\n          flags = ''; // Check for regular expression literals\n      // @see http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.5\n\n      var literal = schema.pattern.match(/^\\/(.+)\\/([img]*)$/);\n\n      if (literal) {\n        body = literal[1];\n        flags = literal[2];\n      } else {\n        body = schema.pattern;\n      }\n\n      regexp = new RegExp(body, flags);\n    }\n\n    if (!regexp.test(data)) {\n      return this.createError(ErrorCodes.STRING_PATTERN, {\n        pattern: schema.pattern\n      }, '', '/pattern', null, data, schema);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateArray = function validateArray(data, schema, dataPointerPath) {\n    if (!Array.isArray(data)) {\n      return null;\n    }\n\n    return this.validateArrayLength(data, schema, dataPointerPath) || this.validateArrayUniqueItems(data, schema, dataPointerPath) || this.validateArrayItems(data, schema, dataPointerPath) || null;\n  };\n\n  ValidatorContext.prototype.validateArrayLength = function validateArrayLength(data, schema) {\n    var error;\n\n    if (schema.minItems !== undefined) {\n      if (data.length < schema.minItems) {\n        error = this.createError(ErrorCodes.ARRAY_LENGTH_SHORT, {\n          length: data.length,\n          minimum: schema.minItems\n        }, '', '/minItems', null, data, schema);\n\n        if (this.handleError(error)) {\n          return error;\n        }\n      }\n    }\n\n    if (schema.maxItems !== undefined) {\n      if (data.length > schema.maxItems) {\n        error = this.createError(ErrorCodes.ARRAY_LENGTH_LONG, {\n          length: data.length,\n          maximum: schema.maxItems\n        }, '', '/maxItems', null, data, schema);\n\n        if (this.handleError(error)) {\n          return error;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateArrayUniqueItems = function validateArrayUniqueItems(data, schema) {\n    if (schema.uniqueItems) {\n      for (var i = 0; i < data.length; i++) {\n        for (var j = i + 1; j < data.length; j++) {\n          if (recursiveCompare(data[i], data[j])) {\n            var error = this.createError(ErrorCodes.ARRAY_UNIQUE, {\n              match1: i,\n              match2: j\n            }, '', '/uniqueItems', null, data, schema);\n\n            if (this.handleError(error)) {\n              return error;\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateArrayItems = function validateArrayItems(data, schema, dataPointerPath) {\n    if (schema.items === undefined) {\n      return null;\n    }\n\n    var error, i;\n\n    if (Array.isArray(schema.items)) {\n      for (i = 0; i < data.length; i++) {\n        if (i < schema.items.length) {\n          if (error = this.validateAll(data[i], schema.items[i], [i], [\"items\", i], dataPointerPath + \"/\" + i)) {\n            return error;\n          }\n        } else if (schema.additionalItems !== undefined) {\n          if (typeof schema.additionalItems === \"boolean\") {\n            if (!schema.additionalItems) {\n              error = this.createError(ErrorCodes.ARRAY_ADDITIONAL_ITEMS, {}, '/' + i, '/additionalItems', null, data, schema);\n\n              if (this.handleError(error)) {\n                return error;\n              }\n            }\n          } else if (error = this.validateAll(data[i], schema.additionalItems, [i], [\"additionalItems\"], dataPointerPath + \"/\" + i)) {\n            return error;\n          }\n        }\n      }\n    } else {\n      for (i = 0; i < data.length; i++) {\n        if (error = this.validateAll(data[i], schema.items, [i], [\"items\"], dataPointerPath + \"/\" + i)) {\n          return error;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateObject = function validateObject(data, schema, dataPointerPath) {\n    if (typeof data !== \"object\" || data === null || Array.isArray(data)) {\n      return null;\n    }\n\n    return this.validateObjectMinMaxProperties(data, schema, dataPointerPath) || this.validateObjectRequiredProperties(data, schema, dataPointerPath) || this.validateObjectProperties(data, schema, dataPointerPath) || this.validateObjectDependencies(data, schema, dataPointerPath) || null;\n  };\n\n  ValidatorContext.prototype.validateObjectMinMaxProperties = function validateObjectMinMaxProperties(data, schema) {\n    var keys = Object.keys(data);\n    var error;\n\n    if (schema.minProperties !== undefined) {\n      if (keys.length < schema.minProperties) {\n        error = this.createError(ErrorCodes.OBJECT_PROPERTIES_MINIMUM, {\n          propertyCount: keys.length,\n          minimum: schema.minProperties\n        }, '', '/minProperties', null, data, schema);\n\n        if (this.handleError(error)) {\n          return error;\n        }\n      }\n    }\n\n    if (schema.maxProperties !== undefined) {\n      if (keys.length > schema.maxProperties) {\n        error = this.createError(ErrorCodes.OBJECT_PROPERTIES_MAXIMUM, {\n          propertyCount: keys.length,\n          maximum: schema.maxProperties\n        }, '', '/maxProperties', null, data, schema);\n\n        if (this.handleError(error)) {\n          return error;\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateObjectRequiredProperties = function validateObjectRequiredProperties(data, schema) {\n    if (schema.required !== undefined) {\n      for (var i = 0; i < schema.required.length; i++) {\n        var key = schema.required[i];\n\n        if (data[key] === undefined) {\n          var error = this.createError(ErrorCodes.OBJECT_REQUIRED, {\n            key: key\n          }, '', '/required/' + i, null, data, schema);\n\n          if (this.handleError(error)) {\n            return error;\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateObjectProperties = function validateObjectProperties(data, schema, dataPointerPath) {\n    var error;\n\n    for (var key in data) {\n      var keyPointerPath = dataPointerPath + \"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1');\n      var foundMatch = false;\n\n      if (schema.properties !== undefined && schema.properties[key] !== undefined) {\n        foundMatch = true;\n\n        if (error = this.validateAll(data[key], schema.properties[key], [key], [\"properties\", key], keyPointerPath)) {\n          return error;\n        }\n      }\n\n      if (schema.patternProperties !== undefined) {\n        for (var patternKey in schema.patternProperties) {\n          var regexp = new RegExp(patternKey);\n\n          if (regexp.test(key)) {\n            foundMatch = true;\n\n            if (error = this.validateAll(data[key], schema.patternProperties[patternKey], [key], [\"patternProperties\", patternKey], keyPointerPath)) {\n              return error;\n            }\n          }\n        }\n      }\n\n      if (!foundMatch) {\n        if (schema.additionalProperties !== undefined) {\n          if (this.trackUnknownProperties) {\n            this.knownPropertyPaths[keyPointerPath] = true;\n            delete this.unknownPropertyPaths[keyPointerPath];\n          }\n\n          if (typeof schema.additionalProperties === \"boolean\") {\n            if (!schema.additionalProperties) {\n              error = this.createError(ErrorCodes.OBJECT_ADDITIONAL_PROPERTIES, {\n                key: key\n              }, '', '/additionalProperties', null, data, schema).prefixWith(key, null);\n\n              if (this.handleError(error)) {\n                return error;\n              }\n            }\n          } else {\n            if (error = this.validateAll(data[key], schema.additionalProperties, [key], [\"additionalProperties\"], keyPointerPath)) {\n              return error;\n            }\n          }\n        } else if (this.trackUnknownProperties && !this.knownPropertyPaths[keyPointerPath]) {\n          this.unknownPropertyPaths[keyPointerPath] = true;\n        }\n      } else if (this.trackUnknownProperties) {\n        this.knownPropertyPaths[keyPointerPath] = true;\n        delete this.unknownPropertyPaths[keyPointerPath];\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateObjectDependencies = function validateObjectDependencies(data, schema, dataPointerPath) {\n    var error;\n\n    if (schema.dependencies !== undefined) {\n      for (var depKey in schema.dependencies) {\n        if (data[depKey] !== undefined) {\n          var dep = schema.dependencies[depKey];\n\n          if (typeof dep === \"string\") {\n            if (data[dep] === undefined) {\n              error = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {\n                key: depKey,\n                missing: dep\n              }, '', '', null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\n\n              if (this.handleError(error)) {\n                return error;\n              }\n            }\n          } else if (Array.isArray(dep)) {\n            for (var i = 0; i < dep.length; i++) {\n              var requiredKey = dep[i];\n\n              if (data[requiredKey] === undefined) {\n                error = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {\n                  key: depKey,\n                  missing: requiredKey\n                }, '', '/' + i, null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\n\n                if (this.handleError(error)) {\n                  return error;\n                }\n              }\n            }\n          } else {\n            if (error = this.validateAll(data, dep, [], [\"dependencies\", depKey], dataPointerPath)) {\n              return error;\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateCombinations = function validateCombinations(data, schema, dataPointerPath) {\n    return this.validateAllOf(data, schema, dataPointerPath) || this.validateAnyOf(data, schema, dataPointerPath) || this.validateOneOf(data, schema, dataPointerPath) || this.validateNot(data, schema, dataPointerPath) || null;\n  };\n\n  ValidatorContext.prototype.validateAllOf = function validateAllOf(data, schema, dataPointerPath) {\n    if (schema.allOf === undefined) {\n      return null;\n    }\n\n    var error;\n\n    for (var i = 0; i < schema.allOf.length; i++) {\n      var subSchema = schema.allOf[i];\n\n      if (error = this.validateAll(data, subSchema, [], [\"allOf\", i], dataPointerPath)) {\n        return error;\n      }\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateAnyOf = function validateAnyOf(data, schema, dataPointerPath) {\n    if (schema.anyOf === undefined) {\n      return null;\n    }\n\n    var errors = [];\n    var startErrorCount = this.errors.length;\n    var oldUnknownPropertyPaths, oldKnownPropertyPaths;\n\n    if (this.trackUnknownProperties) {\n      oldUnknownPropertyPaths = this.unknownPropertyPaths;\n      oldKnownPropertyPaths = this.knownPropertyPaths;\n    }\n\n    var errorAtEnd = true;\n\n    for (var i = 0; i < schema.anyOf.length; i++) {\n      if (this.trackUnknownProperties) {\n        this.unknownPropertyPaths = {};\n        this.knownPropertyPaths = {};\n      }\n\n      var subSchema = schema.anyOf[i];\n      var errorCount = this.errors.length;\n      var error = this.validateAll(data, subSchema, [], [\"anyOf\", i], dataPointerPath);\n\n      if (error === null && errorCount === this.errors.length) {\n        this.errors = this.errors.slice(0, startErrorCount);\n\n        if (this.trackUnknownProperties) {\n          for (var knownKey in this.knownPropertyPaths) {\n            oldKnownPropertyPaths[knownKey] = true;\n            delete oldUnknownPropertyPaths[knownKey];\n          }\n\n          for (var unknownKey in this.unknownPropertyPaths) {\n            if (!oldKnownPropertyPaths[unknownKey]) {\n              oldUnknownPropertyPaths[unknownKey] = true;\n            }\n          } // We need to continue looping so we catch all the property definitions, but we don't want to return an error\n\n\n          errorAtEnd = false;\n          continue;\n        }\n\n        return null;\n      }\n\n      if (error) {\n        errors.push(error.prefixWith(null, \"\" + i).prefixWith(null, \"anyOf\"));\n      }\n    }\n\n    if (this.trackUnknownProperties) {\n      this.unknownPropertyPaths = oldUnknownPropertyPaths;\n      this.knownPropertyPaths = oldKnownPropertyPaths;\n    }\n\n    if (errorAtEnd) {\n      errors = errors.concat(this.errors.slice(startErrorCount));\n      this.errors = this.errors.slice(0, startErrorCount);\n      return this.createError(ErrorCodes.ANY_OF_MISSING, {}, \"\", \"/anyOf\", errors, data, schema);\n    }\n  };\n\n  ValidatorContext.prototype.validateOneOf = function validateOneOf(data, schema, dataPointerPath) {\n    if (schema.oneOf === undefined) {\n      return null;\n    }\n\n    var validIndex = null;\n    var errors = [];\n    var startErrorCount = this.errors.length;\n    var oldUnknownPropertyPaths, oldKnownPropertyPaths;\n\n    if (this.trackUnknownProperties) {\n      oldUnknownPropertyPaths = this.unknownPropertyPaths;\n      oldKnownPropertyPaths = this.knownPropertyPaths;\n    }\n\n    for (var i = 0; i < schema.oneOf.length; i++) {\n      if (this.trackUnknownProperties) {\n        this.unknownPropertyPaths = {};\n        this.knownPropertyPaths = {};\n      }\n\n      var subSchema = schema.oneOf[i];\n      var errorCount = this.errors.length;\n      var error = this.validateAll(data, subSchema, [], [\"oneOf\", i], dataPointerPath);\n\n      if (error === null && errorCount === this.errors.length) {\n        if (validIndex === null) {\n          validIndex = i;\n        } else {\n          this.errors = this.errors.slice(0, startErrorCount);\n          return this.createError(ErrorCodes.ONE_OF_MULTIPLE, {\n            index1: validIndex,\n            index2: i\n          }, \"\", \"/oneOf\", null, data, schema);\n        }\n\n        if (this.trackUnknownProperties) {\n          for (var knownKey in this.knownPropertyPaths) {\n            oldKnownPropertyPaths[knownKey] = true;\n            delete oldUnknownPropertyPaths[knownKey];\n          }\n\n          for (var unknownKey in this.unknownPropertyPaths) {\n            if (!oldKnownPropertyPaths[unknownKey]) {\n              oldUnknownPropertyPaths[unknownKey] = true;\n            }\n          }\n        }\n      } else if (error) {\n        errors.push(error);\n      }\n    }\n\n    if (this.trackUnknownProperties) {\n      this.unknownPropertyPaths = oldUnknownPropertyPaths;\n      this.knownPropertyPaths = oldKnownPropertyPaths;\n    }\n\n    if (validIndex === null) {\n      errors = errors.concat(this.errors.slice(startErrorCount));\n      this.errors = this.errors.slice(0, startErrorCount);\n      return this.createError(ErrorCodes.ONE_OF_MISSING, {}, \"\", \"/oneOf\", errors, data, schema);\n    } else {\n      this.errors = this.errors.slice(0, startErrorCount);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateNot = function validateNot(data, schema, dataPointerPath) {\n    if (schema.not === undefined) {\n      return null;\n    }\n\n    var oldErrorCount = this.errors.length;\n    var oldUnknownPropertyPaths, oldKnownPropertyPaths;\n\n    if (this.trackUnknownProperties) {\n      oldUnknownPropertyPaths = this.unknownPropertyPaths;\n      oldKnownPropertyPaths = this.knownPropertyPaths;\n      this.unknownPropertyPaths = {};\n      this.knownPropertyPaths = {};\n    }\n\n    var error = this.validateAll(data, schema.not, null, null, dataPointerPath);\n    var notErrors = this.errors.slice(oldErrorCount);\n    this.errors = this.errors.slice(0, oldErrorCount);\n\n    if (this.trackUnknownProperties) {\n      this.unknownPropertyPaths = oldUnknownPropertyPaths;\n      this.knownPropertyPaths = oldKnownPropertyPaths;\n    }\n\n    if (error === null && notErrors.length === 0) {\n      return this.createError(ErrorCodes.NOT_PASSED, {}, \"\", \"/not\", null, data, schema);\n    }\n\n    return null;\n  };\n\n  ValidatorContext.prototype.validateHypermedia = function validateCombinations(data, schema, dataPointerPath) {\n    if (!schema.links) {\n      return null;\n    }\n\n    var error;\n\n    for (var i = 0; i < schema.links.length; i++) {\n      var ldo = schema.links[i];\n\n      if (ldo.rel === \"describedby\") {\n        var template = new UriTemplate(ldo.href);\n        var allPresent = true;\n\n        for (var j = 0; j < template.varNames.length; j++) {\n          if (!(template.varNames[j] in data)) {\n            allPresent = false;\n            break;\n          }\n        }\n\n        if (allPresent) {\n          var schemaUrl = template.fillFromObject(data);\n          var subSchema = {\n            \"$ref\": schemaUrl\n          };\n\n          if (error = this.validateAll(data, subSchema, [], [\"links\", i], dataPointerPath)) {\n            return error;\n          }\n        }\n      }\n    }\n  }; // parseURI() and resolveUrl() are from https://gist.github.com/1088850\n  //   -  released as public domain by author (\"Yaffle\") - see comments on gist\n\n\n  function parseURI(url) {\n    var m = String(url).replace(/^\\s+|\\s+$/g, '').match(/^([^:\\/?#]+:)?(\\/\\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\\/?#]*)(?::(\\d*))?))?([^?#]*)(\\?[^#]*)?(#[\\s\\S]*)?/); // authority = '//' + user + ':' + pass '@' + hostname + ':' port\n\n    return m ? {\n      href: m[0] || '',\n      protocol: m[1] || '',\n      authority: m[2] || '',\n      host: m[3] || '',\n      hostname: m[4] || '',\n      port: m[5] || '',\n      pathname: m[6] || '',\n      search: m[7] || '',\n      hash: m[8] || ''\n    } : null;\n  }\n\n  function resolveUrl(base, href) {\n    // RFC 3986\n    function removeDotSegments(input) {\n      var output = [];\n      input.replace(/^(\\.\\.?(\\/|$))+/, '').replace(/\\/(\\.(\\/|$))+/g, '/').replace(/\\/\\.\\.$/, '/../').replace(/\\/?[^\\/]*/g, function (p) {\n        if (p === '/..') {\n          output.pop();\n        } else {\n          output.push(p);\n        }\n      });\n      return output.join('').replace(/^\\//, input.charAt(0) === '/' ? '/' : '');\n    }\n\n    href = parseURI(href || '');\n    base = parseURI(base || '');\n    return !href || !base ? null : (href.protocol || base.protocol) + (href.protocol || href.authority ? href.authority : base.authority) + removeDotSegments(href.protocol || href.authority || href.pathname.charAt(0) === '/' ? href.pathname : href.pathname ? (base.authority && !base.pathname ? '/' : '') + base.pathname.slice(0, base.pathname.lastIndexOf('/') + 1) + href.pathname : base.pathname) + (href.protocol || href.authority || href.pathname ? href.search : href.search || base.search) + href.hash;\n  }\n\n  function getDocumentUri(uri) {\n    return uri.split('#')[0];\n  }\n\n  function normSchema(schema, baseUri) {\n    if (schema && typeof schema === \"object\") {\n      if (baseUri === undefined) {\n        baseUri = schema.id;\n      } else if (typeof schema.id === \"string\") {\n        baseUri = resolveUrl(baseUri, schema.id);\n        schema.id = baseUri;\n      }\n\n      if (Array.isArray(schema)) {\n        for (var i = 0; i < schema.length; i++) {\n          normSchema(schema[i], baseUri);\n        }\n      } else {\n        if (typeof schema['$ref'] === \"string\") {\n          schema['$ref'] = resolveUrl(baseUri, schema['$ref']);\n        }\n\n        for (var key in schema) {\n          if (key !== \"enum\") {\n            normSchema(schema[key], baseUri);\n          }\n        }\n      }\n    }\n  }\n\n  function defaultErrorReporter(language) {\n    language = language || 'en';\n    var errorMessages = languages[language];\n    return function (error) {\n      var messageTemplate = errorMessages[error.code] || ErrorMessagesDefault[error.code];\n\n      if (typeof messageTemplate !== 'string') {\n        return \"Unknown error code \" + error.code + \": \" + JSON.stringify(error.messageParams);\n      }\n\n      var messageParams = error.params; // Adapted from Crockford's supplant()\n\n      return messageTemplate.replace(/\\{([^{}]*)\\}/g, function (whole, varName) {\n        var subValue = messageParams[varName];\n        return typeof subValue === 'string' || typeof subValue === 'number' ? subValue : whole;\n      });\n    };\n  }\n\n  var ErrorCodes = {\n    INVALID_TYPE: 0,\n    ENUM_MISMATCH: 1,\n    ANY_OF_MISSING: 10,\n    ONE_OF_MISSING: 11,\n    ONE_OF_MULTIPLE: 12,\n    NOT_PASSED: 13,\n    // Numeric errors\n    NUMBER_MULTIPLE_OF: 100,\n    NUMBER_MINIMUM: 101,\n    NUMBER_MINIMUM_EXCLUSIVE: 102,\n    NUMBER_MAXIMUM: 103,\n    NUMBER_MAXIMUM_EXCLUSIVE: 104,\n    NUMBER_NOT_A_NUMBER: 105,\n    // String errors\n    STRING_LENGTH_SHORT: 200,\n    STRING_LENGTH_LONG: 201,\n    STRING_PATTERN: 202,\n    // Object errors\n    OBJECT_PROPERTIES_MINIMUM: 300,\n    OBJECT_PROPERTIES_MAXIMUM: 301,\n    OBJECT_REQUIRED: 302,\n    OBJECT_ADDITIONAL_PROPERTIES: 303,\n    OBJECT_DEPENDENCY_KEY: 304,\n    // Array errors\n    ARRAY_LENGTH_SHORT: 400,\n    ARRAY_LENGTH_LONG: 401,\n    ARRAY_UNIQUE: 402,\n    ARRAY_ADDITIONAL_ITEMS: 403,\n    // Custom/user-defined errors\n    FORMAT_CUSTOM: 500,\n    KEYWORD_CUSTOM: 501,\n    // Schema structure\n    CIRCULAR_REFERENCE: 600,\n    // Non-standard validation options\n    UNKNOWN_PROPERTY: 1000\n  };\n  var ErrorCodeLookup = {};\n\n  for (var key in ErrorCodes) {\n    ErrorCodeLookup[ErrorCodes[key]] = key;\n  }\n\n  var ErrorMessagesDefault = {\n    INVALID_TYPE: \"Invalid type: {type} (expected {expected})\",\n    ENUM_MISMATCH: \"No enum match for: {value}\",\n    ANY_OF_MISSING: \"Data does not match any schemas from \\\"anyOf\\\"\",\n    ONE_OF_MISSING: \"Data does not match any schemas from \\\"oneOf\\\"\",\n    ONE_OF_MULTIPLE: \"Data is valid against more than one schema from \\\"oneOf\\\": indices {index1} and {index2}\",\n    NOT_PASSED: \"Data matches schema from \\\"not\\\"\",\n    // Numeric errors\n    NUMBER_MULTIPLE_OF: \"Value {value} is not a multiple of {multipleOf}\",\n    NUMBER_MINIMUM: \"Value {value} is less than minimum {minimum}\",\n    NUMBER_MINIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive minimum {minimum}\",\n    NUMBER_MAXIMUM: \"Value {value} is greater than maximum {maximum}\",\n    NUMBER_MAXIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive maximum {maximum}\",\n    NUMBER_NOT_A_NUMBER: \"Value {value} is not a valid number\",\n    // String errors\n    STRING_LENGTH_SHORT: \"String is too short ({length} chars), minimum {minimum}\",\n    STRING_LENGTH_LONG: \"String is too long ({length} chars), maximum {maximum}\",\n    STRING_PATTERN: \"String does not match pattern: {pattern}\",\n    // Object errors\n    OBJECT_PROPERTIES_MINIMUM: \"Too few properties defined ({propertyCount}), minimum {minimum}\",\n    OBJECT_PROPERTIES_MAXIMUM: \"Too many properties defined ({propertyCount}), maximum {maximum}\",\n    OBJECT_REQUIRED: \"Missing required property: {key}\",\n    OBJECT_ADDITIONAL_PROPERTIES: \"Additional properties not allowed\",\n    OBJECT_DEPENDENCY_KEY: \"Dependency failed - key must exist: {missing} (due to key: {key})\",\n    // Array errors\n    ARRAY_LENGTH_SHORT: \"Array is too short ({length}), minimum {minimum}\",\n    ARRAY_LENGTH_LONG: \"Array is too long ({length}), maximum {maximum}\",\n    ARRAY_UNIQUE: \"Array items are not unique (indices {match1} and {match2})\",\n    ARRAY_ADDITIONAL_ITEMS: \"Additional items not allowed\",\n    // Format errors\n    FORMAT_CUSTOM: \"Format validation failed ({message})\",\n    KEYWORD_CUSTOM: \"Keyword failed: {key} ({message})\",\n    // Schema structure\n    CIRCULAR_REFERENCE: \"Circular $refs: {urls}\",\n    // Non-standard validation options\n    UNKNOWN_PROPERTY: \"Unknown property (not in schema)\"\n  };\n\n  function ValidationError(code, params, dataPath, schemaPath, subErrors) {\n    Error.call(this);\n\n    if (code === undefined) {\n      throw new Error(\"No error code supplied: \" + schemaPath);\n    }\n\n    this.message = '';\n    this.params = params;\n    this.code = code;\n    this.dataPath = dataPath || \"\";\n    this.schemaPath = schemaPath || \"\";\n    this.subErrors = subErrors || null;\n    var err = new Error(this.message);\n    this.stack = err.stack || err.stacktrace;\n\n    if (!this.stack) {\n      try {\n        throw err;\n      } catch (err) {\n        this.stack = err.stack || err.stacktrace;\n      }\n    }\n  }\n\n  ValidationError.prototype = Object.create(Error.prototype);\n  ValidationError.prototype.constructor = ValidationError;\n  ValidationError.prototype.name = 'ValidationError';\n\n  ValidationError.prototype.prefixWith = function (dataPrefix, schemaPrefix) {\n    if (dataPrefix !== null) {\n      dataPrefix = dataPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\n      this.dataPath = \"/\" + dataPrefix + this.dataPath;\n    }\n\n    if (schemaPrefix !== null) {\n      schemaPrefix = schemaPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\n      this.schemaPath = \"/\" + schemaPrefix + this.schemaPath;\n    }\n\n    if (this.subErrors !== null) {\n      for (var i = 0; i < this.subErrors.length; i++) {\n        this.subErrors[i].prefixWith(dataPrefix, schemaPrefix);\n      }\n    }\n\n    return this;\n  };\n\n  function isTrustedUrl(baseUrl, testUrl) {\n    if (testUrl.substring(0, baseUrl.length) === baseUrl) {\n      var remainder = testUrl.substring(baseUrl.length);\n\n      if (testUrl.length > 0 && testUrl.charAt(baseUrl.length - 1) === \"/\" || remainder.charAt(0) === \"#\" || remainder.charAt(0) === \"?\") {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  var languages = {};\n\n  function createApi(language) {\n    var globalContext = new ValidatorContext();\n    var currentLanguage;\n    var customErrorReporter;\n    var api = {\n      setErrorReporter: function (reporter) {\n        if (typeof reporter === 'string') {\n          return this.language(reporter);\n        }\n\n        customErrorReporter = reporter;\n        return true;\n      },\n      addFormat: function () {\n        globalContext.addFormat.apply(globalContext, arguments);\n      },\n      language: function (code) {\n        if (!code) {\n          return currentLanguage;\n        }\n\n        if (!languages[code]) {\n          code = code.split('-')[0]; // fall back to base language\n        }\n\n        if (languages[code]) {\n          currentLanguage = code;\n          return code; // so you can tell if fall-back has happened\n        }\n\n        return false;\n      },\n      addLanguage: function (code, messageMap) {\n        var key;\n\n        for (key in ErrorCodes) {\n          if (messageMap[key] && !messageMap[ErrorCodes[key]]) {\n            messageMap[ErrorCodes[key]] = messageMap[key];\n          }\n        }\n\n        var rootCode = code.split('-')[0];\n\n        if (!languages[rootCode]) {\n          // use for base language if not yet defined\n          languages[code] = messageMap;\n          languages[rootCode] = messageMap;\n        } else {\n          languages[code] = Object.create(languages[rootCode]);\n\n          for (key in messageMap) {\n            if (typeof languages[rootCode][key] === 'undefined') {\n              languages[rootCode][key] = messageMap[key];\n            }\n\n            languages[code][key] = messageMap[key];\n          }\n        }\n\n        return this;\n      },\n      freshApi: function (language) {\n        var result = createApi();\n\n        if (language) {\n          result.language(language);\n        }\n\n        return result;\n      },\n      validate: function (data, schema, checkRecursive, banUnknownProperties) {\n        var def = defaultErrorReporter(currentLanguage);\n        var errorReporter = customErrorReporter ? function (error, data, schema) {\n          return customErrorReporter(error, data, schema) || def(error, data, schema);\n        } : def;\n        var context = new ValidatorContext(globalContext, false, errorReporter, checkRecursive, banUnknownProperties);\n\n        if (typeof schema === \"string\") {\n          schema = {\n            \"$ref\": schema\n          };\n        }\n\n        context.addSchema(\"\", schema);\n        var error = context.validateAll(data, schema, null, null, \"\");\n\n        if (!error && banUnknownProperties) {\n          error = context.banUnknownProperties(data, schema);\n        }\n\n        this.error = error;\n        this.missing = context.missing;\n        this.valid = error === null;\n        return this.valid;\n      },\n      validateResult: function () {\n        var result = {\n          toString: function () {\n            return this.valid ? 'valid' : this.error.message;\n          }\n        };\n        this.validate.apply(result, arguments);\n        return result;\n      },\n      validateMultiple: function (data, schema, checkRecursive, banUnknownProperties) {\n        var def = defaultErrorReporter(currentLanguage);\n        var errorReporter = customErrorReporter ? function (error, data, schema) {\n          return customErrorReporter(error, data, schema) || def(error, data, schema);\n        } : def;\n        var context = new ValidatorContext(globalContext, true, errorReporter, checkRecursive, banUnknownProperties);\n\n        if (typeof schema === \"string\") {\n          schema = {\n            \"$ref\": schema\n          };\n        }\n\n        context.addSchema(\"\", schema);\n        context.validateAll(data, schema, null, null, \"\");\n\n        if (banUnknownProperties) {\n          context.banUnknownProperties(data, schema);\n        }\n\n        var result = {\n          toString: function () {\n            return this.valid ? 'valid' : this.error.message;\n          }\n        };\n        result.errors = context.errors;\n        result.missing = context.missing;\n        result.valid = result.errors.length === 0;\n        return result;\n      },\n      addSchema: function () {\n        return globalContext.addSchema.apply(globalContext, arguments);\n      },\n      getSchema: function () {\n        return globalContext.getSchema.apply(globalContext, arguments);\n      },\n      getSchemaMap: function () {\n        return globalContext.getSchemaMap.apply(globalContext, arguments);\n      },\n      getSchemaUris: function () {\n        return globalContext.getSchemaUris.apply(globalContext, arguments);\n      },\n      getMissingUris: function () {\n        return globalContext.getMissingUris.apply(globalContext, arguments);\n      },\n      dropSchemas: function () {\n        globalContext.dropSchemas.apply(globalContext, arguments);\n      },\n      defineKeyword: function () {\n        globalContext.defineKeyword.apply(globalContext, arguments);\n      },\n      defineError: function (codeName, codeNumber, defaultMessage) {\n        if (typeof codeName !== 'string' || !/^[A-Z]+(_[A-Z]+)*$/.test(codeName)) {\n          throw new Error('Code name must be a string in UPPER_CASE_WITH_UNDERSCORES');\n        }\n\n        if (typeof codeNumber !== 'number' || codeNumber % 1 !== 0 || codeNumber < 10000) {\n          throw new Error('Code number must be an integer > 10000');\n        }\n\n        if (typeof ErrorCodes[codeName] !== 'undefined') {\n          throw new Error('Error already defined: ' + codeName + ' as ' + ErrorCodes[codeName]);\n        }\n\n        if (typeof ErrorCodeLookup[codeNumber] !== 'undefined') {\n          throw new Error('Error code already used: ' + ErrorCodeLookup[codeNumber] + ' as ' + codeNumber);\n        }\n\n        ErrorCodes[codeName] = codeNumber;\n        ErrorCodeLookup[codeNumber] = codeName;\n        ErrorMessagesDefault[codeName] = ErrorMessagesDefault[codeNumber] = defaultMessage;\n\n        for (var langCode in languages) {\n          var language = languages[langCode];\n\n          if (language[codeName]) {\n            language[codeNumber] = language[codeNumber] || language[codeName];\n          }\n        }\n      },\n      reset: function () {\n        globalContext.reset();\n        this.error = null;\n        this.missing = [];\n        this.valid = true;\n      },\n      missing: [],\n      error: null,\n      valid: true,\n      normSchema: normSchema,\n      resolveUrl: resolveUrl,\n      getDocumentUri: getDocumentUri,\n      errorCodes: ErrorCodes\n    };\n    api.language(language || 'en');\n    return api;\n  }\n\n  var tv4 = createApi();\n  tv4.addLanguage('en-gb', ErrorMessagesDefault); //legacy property\n\n  tv4.tv4 = tv4;\n  return tv4; // used by _header.js to globalise.\n});","map":{"version":3,"sources":["/Users/griselmatos/projects/personal/testing_react/node_modules/tv4/tv4.js"],"names":["global","factory","define","amd","module","exports","tv4","Object","keys","hasOwnProperty","prototype","hasDontEnumBug","toString","propertyIsEnumerable","dontEnums","dontEnumsLength","length","obj","TypeError","result","prop","call","push","i","create","F","o","arguments","Error","Array","isArray","vArg","indexOf","searchElement","t","len","n","Number","Infinity","Math","floor","abs","k","max","isFrozen","key","random","e","uriTemplateGlobalModifiers","uriTemplateSuffices","notReallyPercentEncode","string","encodeURI","replace","doubleEncoded","substring","uriTemplateSubstitution","spec","modifier","charAt","separator","prefix","shouldEscape","showVariables","trimEmptyString","varNames","varList","split","varSpecs","varSpecMap","varName","truncate","parts","parseInt","suffices","varSpec","name","subFunction","valueFunction","startIndex","value","undefined","j","encodeURIComponent","first","substitution","UriTemplate","template","textParts","shift","prefixes","substitutions","part","remainder","funcs","concat","fill","fillFromObject","ValidatorContext","parent","collectMultiple","errorReporter","checkRecursive","trackUnknownProperties","missing","missingMap","formatValidators","schemas","errors","handleError","collectError","returnError","scanned","scannedFrozen","scannedFrozenSchemas","scannedFrozenValidationErrors","validatedSchemasKey","validationErrorsKey","knownPropertyPaths","unknownPropertyPaths","defaultErrorReporter","definedKeywords","slice","defineKeyword","keyword","keywordFunction","createError","code","messageParams","dataPath","schemaPath","subErrors","data","schema","error","ValidationError","message","prefixErrors","prefixWith","banUnknownProperties","unknownPath","ErrorCodes","UNKNOWN_PROPERTY","path","addFormat","format","validator","resolveRefs","urlHistory","CIRCULAR_REFERENCE","urls","join","getSchema","url","baseUrl","fragment","pointerPath","decodeURIComponent","component","searchSchemas","id","isTrustedUrl","uri","getDocumentUri","addSchema","normSchema","getSchemaMap","map","getSchemaUris","filterRegExp","list","test","getMissingUris","dropSchemas","reset","validateAll","dataPathParts","schemaPathParts","dataPointerPath","topLevel","startErrorCount","frozenIndex","scannedFrozenSchemaIndex","scannedSchemasIndex","schemaIndex","frozenSchemaIndex","defineProperty","configurable","errorCount","validateBasic","validateNumeric","validateString","validateArray","validateObject","validateCombinations","validateHypermedia","validateFormat","validateDefinedKeywords","item","pop","dataPart","schemaPart","errorMessage","FORMAT_CUSTOM","validationFunctions","func","KEYWORD_CUSTOM","recursiveCompare","A","B","validateType","validateEnum","type","dataType","allowedTypes","INVALID_TYPE","expected","enumVal","ENUM_MISMATCH","JSON","stringify","validateMultipleOf","validateMinMax","validateNaN","CLOSE_ENOUGH_LOW","pow","CLOSE_ENOUGH_HIGH","multipleOf","divisibleBy","NUMBER_MULTIPLE_OF","minimum","NUMBER_MINIMUM","exclusiveMinimum","NUMBER_MINIMUM_EXCLUSIVE","maximum","NUMBER_MAXIMUM","exclusiveMaximum","NUMBER_MAXIMUM_EXCLUSIVE","isNaN","NUMBER_NOT_A_NUMBER","validateStringLength","validateStringPattern","minLength","STRING_LENGTH_SHORT","maxLength","STRING_LENGTH_LONG","pattern","RegExp","regexp","body","flags","literal","match","STRING_PATTERN","validateArrayLength","validateArrayUniqueItems","validateArrayItems","minItems","ARRAY_LENGTH_SHORT","maxItems","ARRAY_LENGTH_LONG","uniqueItems","ARRAY_UNIQUE","match1","match2","items","additionalItems","ARRAY_ADDITIONAL_ITEMS","validateObjectMinMaxProperties","validateObjectRequiredProperties","validateObjectProperties","validateObjectDependencies","minProperties","OBJECT_PROPERTIES_MINIMUM","propertyCount","maxProperties","OBJECT_PROPERTIES_MAXIMUM","required","OBJECT_REQUIRED","keyPointerPath","foundMatch","properties","patternProperties","patternKey","additionalProperties","OBJECT_ADDITIONAL_PROPERTIES","dependencies","depKey","dep","OBJECT_DEPENDENCY_KEY","requiredKey","validateAllOf","validateAnyOf","validateOneOf","validateNot","allOf","subSchema","anyOf","oldUnknownPropertyPaths","oldKnownPropertyPaths","errorAtEnd","knownKey","unknownKey","ANY_OF_MISSING","oneOf","validIndex","ONE_OF_MULTIPLE","index1","index2","ONE_OF_MISSING","not","oldErrorCount","notErrors","NOT_PASSED","links","ldo","rel","href","allPresent","schemaUrl","parseURI","m","String","protocol","authority","host","hostname","port","pathname","search","hash","resolveUrl","base","removeDotSegments","input","output","p","lastIndexOf","baseUri","language","errorMessages","languages","messageTemplate","ErrorMessagesDefault","params","whole","subValue","ErrorCodeLookup","err","stack","stacktrace","constructor","dataPrefix","schemaPrefix","testUrl","createApi","globalContext","currentLanguage","customErrorReporter","api","setErrorReporter","reporter","apply","addLanguage","messageMap","rootCode","freshApi","validate","def","context","valid","validateResult","validateMultiple","defineError","codeName","codeNumber","defaultMessage","langCode","errorCodes"],"mappings":"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","sourcesContent":["/*\r\nAuthor: Geraint Luff and others\r\nYear: 2013\r\n\r\nThis code is released into the \"public domain\" by its author(s).  Anybody may use, alter and distribute the code without restriction.  The author makes no guarantees, and takes no liability of any kind for use of this code.\r\n\r\nIf you find a bug or make an improvement, it would be courteous to let the author know, but it is not compulsory.\r\n*/\r\n(function (global, factory) {\r\n  if (typeof define === 'function' && define.amd) {\r\n    // AMD. Register as an anonymous module.\r\n    define([], factory);\r\n  } else if (typeof module !== 'undefined' && module.exports){\r\n    // CommonJS. Define export.\r\n    module.exports = factory();\r\n  } else {\r\n    // Browser globals\r\n    global.tv4 = factory();\r\n  }\r\n}(this, function () {\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FObject%2Fkeys\r\nif (!Object.keys) {\r\n\tObject.keys = (function () {\r\n\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\r\n\t\t\thasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),\r\n\t\t\tdontEnums = [\r\n\t\t\t\t'toString',\r\n\t\t\t\t'toLocaleString',\r\n\t\t\t\t'valueOf',\r\n\t\t\t\t'hasOwnProperty',\r\n\t\t\t\t'isPrototypeOf',\r\n\t\t\t\t'propertyIsEnumerable',\r\n\t\t\t\t'constructor'\r\n\t\t\t],\r\n\t\t\tdontEnumsLength = dontEnums.length;\r\n\r\n\t\treturn function (obj) {\r\n\t\t\tif (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\r\n\t\t\t\tthrow new TypeError('Object.keys called on non-object');\r\n\t\t\t}\r\n\r\n\t\t\tvar result = [];\r\n\r\n\t\t\tfor (var prop in obj) {\r\n\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\r\n\t\t\t\t\tresult.push(prop);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (hasDontEnumBug) {\r\n\t\t\t\tfor (var i=0; i < dontEnumsLength; i++) {\r\n\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\r\n\t\t\t\t\t\tresult.push(dontEnums[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t};\r\n\t})();\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\r\nif (!Object.create) {\r\n\tObject.create = (function(){\r\n\t\tfunction F(){}\r\n\r\n\t\treturn function(o){\r\n\t\t\tif (arguments.length !== 1) {\r\n\t\t\t\tthrow new Error('Object.create implementation only accepts one parameter.');\r\n\t\t\t}\r\n\t\t\tF.prototype = o;\r\n\t\t\treturn new F();\r\n\t\t};\r\n\t})();\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FisArray\r\nif(!Array.isArray) {\r\n\tArray.isArray = function (vArg) {\r\n\t\treturn Object.prototype.toString.call(vArg) === \"[object Array]\";\r\n\t};\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FindexOf\r\nif (!Array.prototype.indexOf) {\r\n\tArray.prototype.indexOf = function (searchElement /*, fromIndex */ ) {\r\n\t\tif (this === null) {\r\n\t\t\tthrow new TypeError();\r\n\t\t}\r\n\t\tvar t = Object(this);\r\n\t\tvar len = t.length >>> 0;\r\n\r\n\t\tif (len === 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tvar n = 0;\r\n\t\tif (arguments.length > 1) {\r\n\t\t\tn = Number(arguments[1]);\r\n\t\t\tif (n !== n) { // shortcut for verifying if it's NaN\r\n\t\t\t\tn = 0;\r\n\t\t\t} else if (n !== 0 && n !== Infinity && n !== -Infinity) {\r\n\t\t\t\tn = (n > 0 || -1) * Math.floor(Math.abs(n));\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (n >= len) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tvar k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\r\n\t\tfor (; k < len; k++) {\r\n\t\t\tif (k in t && t[k] === searchElement) {\r\n\t\t\t\treturn k;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n}\r\n\r\n// Grungey Object.isFrozen hack\r\nif (!Object.isFrozen) {\r\n\tObject.isFrozen = function (obj) {\r\n\t\tvar key = \"tv4_test_frozen_key\";\r\n\t\twhile (obj.hasOwnProperty(key)) {\r\n\t\t\tkey += Math.random();\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tobj[key] = true;\r\n\t\t\tdelete obj[key];\r\n\t\t\treturn false;\r\n\t\t} catch (e) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t};\r\n}\r\n// Based on: https://github.com/geraintluff/uri-templates, but with all the de-substitution stuff removed\r\n\r\nvar uriTemplateGlobalModifiers = {\r\n\t\"+\": true,\r\n\t\"#\": true,\r\n\t\".\": true,\r\n\t\"/\": true,\r\n\t\";\": true,\r\n\t\"?\": true,\r\n\t\"&\": true\r\n};\r\nvar uriTemplateSuffices = {\r\n\t\"*\": true\r\n};\r\n\r\nfunction notReallyPercentEncode(string) {\r\n\treturn encodeURI(string).replace(/%25[0-9][0-9]/g, function (doubleEncoded) {\r\n\t\treturn \"%\" + doubleEncoded.substring(3);\r\n\t});\r\n}\r\n\r\nfunction uriTemplateSubstitution(spec) {\r\n\tvar modifier = \"\";\r\n\tif (uriTemplateGlobalModifiers[spec.charAt(0)]) {\r\n\t\tmodifier = spec.charAt(0);\r\n\t\tspec = spec.substring(1);\r\n\t}\r\n\tvar separator = \"\";\r\n\tvar prefix = \"\";\r\n\tvar shouldEscape = true;\r\n\tvar showVariables = false;\r\n\tvar trimEmptyString = false;\r\n\tif (modifier === '+') {\r\n\t\tshouldEscape = false;\r\n\t} else if (modifier === \".\") {\r\n\t\tprefix = \".\";\r\n\t\tseparator = \".\";\r\n\t} else if (modifier === \"/\") {\r\n\t\tprefix = \"/\";\r\n\t\tseparator = \"/\";\r\n\t} else if (modifier === '#') {\r\n\t\tprefix = \"#\";\r\n\t\tshouldEscape = false;\r\n\t} else if (modifier === ';') {\r\n\t\tprefix = \";\";\r\n\t\tseparator = \";\";\r\n\t\tshowVariables = true;\r\n\t\ttrimEmptyString = true;\r\n\t} else if (modifier === '?') {\r\n\t\tprefix = \"?\";\r\n\t\tseparator = \"&\";\r\n\t\tshowVariables = true;\r\n\t} else if (modifier === '&') {\r\n\t\tprefix = \"&\";\r\n\t\tseparator = \"&\";\r\n\t\tshowVariables = true;\r\n\t}\r\n\r\n\tvar varNames = [];\r\n\tvar varList = spec.split(\",\");\r\n\tvar varSpecs = [];\r\n\tvar varSpecMap = {};\r\n\tfor (var i = 0; i < varList.length; i++) {\r\n\t\tvar varName = varList[i];\r\n\t\tvar truncate = null;\r\n\t\tif (varName.indexOf(\":\") !== -1) {\r\n\t\t\tvar parts = varName.split(\":\");\r\n\t\t\tvarName = parts[0];\r\n\t\t\ttruncate = parseInt(parts[1], 10);\r\n\t\t}\r\n\t\tvar suffices = {};\r\n\t\twhile (uriTemplateSuffices[varName.charAt(varName.length - 1)]) {\r\n\t\t\tsuffices[varName.charAt(varName.length - 1)] = true;\r\n\t\t\tvarName = varName.substring(0, varName.length - 1);\r\n\t\t}\r\n\t\tvar varSpec = {\r\n\t\t\ttruncate: truncate,\r\n\t\t\tname: varName,\r\n\t\t\tsuffices: suffices\r\n\t\t};\r\n\t\tvarSpecs.push(varSpec);\r\n\t\tvarSpecMap[varName] = varSpec;\r\n\t\tvarNames.push(varName);\r\n\t}\r\n\tvar subFunction = function (valueFunction) {\r\n\t\tvar result = \"\";\r\n\t\tvar startIndex = 0;\r\n\t\tfor (var i = 0; i < varSpecs.length; i++) {\r\n\t\t\tvar varSpec = varSpecs[i];\r\n\t\t\tvar value = valueFunction(varSpec.name);\r\n\t\t\tif (value === null || value === undefined || (Array.isArray(value) && value.length === 0) || (typeof value === 'object' && Object.keys(value).length === 0)) {\r\n\t\t\t\tstartIndex++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (i === startIndex) {\r\n\t\t\t\tresult += prefix;\r\n\t\t\t} else {\r\n\t\t\t\tresult += (separator || \",\");\r\n\t\t\t}\r\n\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\tif (showVariables) {\r\n\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t}\r\n\t\t\t\tfor (var j = 0; j < value.length; j++) {\r\n\t\t\t\t\tif (j > 0) {\r\n\t\t\t\t\t\tresult += varSpec.suffices['*'] ? (separator || \",\") : \",\";\r\n\t\t\t\t\t\tif (varSpec.suffices['*'] && showVariables) {\r\n\t\t\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[j]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[j]);\r\n\t\t\t\t}\r\n\t\t\t} else if (typeof value === \"object\") {\r\n\t\t\t\tif (showVariables && !varSpec.suffices['*']) {\r\n\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t}\r\n\t\t\t\tvar first = true;\r\n\t\t\t\tfor (var key in value) {\r\n\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\tresult += varSpec.suffices['*'] ? (separator || \",\") : \",\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(key).replace(/!/g, \"%21\") : notReallyPercentEncode(key);\r\n\t\t\t\t\tresult += varSpec.suffices['*'] ? '=' : \",\";\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[key]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[key]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (showVariables) {\r\n\t\t\t\t\tresult += varSpec.name;\r\n\t\t\t\t\tif (!trimEmptyString || value !== \"\") {\r\n\t\t\t\t\t\tresult += \"=\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (varSpec.truncate != null) {\r\n\t\t\t\t\tvalue = value.substring(0, varSpec.truncate);\r\n\t\t\t\t}\r\n\t\t\t\tresult += shouldEscape ? encodeURIComponent(value).replace(/!/g, \"%21\"): notReallyPercentEncode(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tsubFunction.varNames = varNames;\r\n\treturn {\r\n\t\tprefix: prefix,\r\n\t\tsubstitution: subFunction\r\n\t};\r\n}\r\n\r\nfunction UriTemplate(template) {\r\n\tif (!(this instanceof UriTemplate)) {\r\n\t\treturn new UriTemplate(template);\r\n\t}\r\n\tvar parts = template.split(\"{\");\r\n\tvar textParts = [parts.shift()];\r\n\tvar prefixes = [];\r\n\tvar substitutions = [];\r\n\tvar varNames = [];\r\n\twhile (parts.length > 0) {\r\n\t\tvar part = parts.shift();\r\n\t\tvar spec = part.split(\"}\")[0];\r\n\t\tvar remainder = part.substring(spec.length + 1);\r\n\t\tvar funcs = uriTemplateSubstitution(spec);\r\n\t\tsubstitutions.push(funcs.substitution);\r\n\t\tprefixes.push(funcs.prefix);\r\n\t\ttextParts.push(remainder);\r\n\t\tvarNames = varNames.concat(funcs.substitution.varNames);\r\n\t}\r\n\tthis.fill = function (valueFunction) {\r\n\t\tvar result = textParts[0];\r\n\t\tfor (var i = 0; i < substitutions.length; i++) {\r\n\t\t\tvar substitution = substitutions[i];\r\n\t\t\tresult += substitution(valueFunction);\r\n\t\t\tresult += textParts[i + 1];\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tthis.varNames = varNames;\r\n\tthis.template = template;\r\n}\r\nUriTemplate.prototype = {\r\n\ttoString: function () {\r\n\t\treturn this.template;\r\n\t},\r\n\tfillFromObject: function (obj) {\r\n\t\treturn this.fill(function (varName) {\r\n\t\t\treturn obj[varName];\r\n\t\t});\r\n\t}\r\n};\r\nvar ValidatorContext = function ValidatorContext(parent, collectMultiple, errorReporter, checkRecursive, trackUnknownProperties) {\r\n\tthis.missing = [];\r\n\tthis.missingMap = {};\r\n\tthis.formatValidators = parent ? Object.create(parent.formatValidators) : {};\r\n\tthis.schemas = parent ? Object.create(parent.schemas) : {};\r\n\tthis.collectMultiple = collectMultiple;\r\n\tthis.errors = [];\r\n\tthis.handleError = collectMultiple ? this.collectError : this.returnError;\r\n\tif (checkRecursive) {\r\n\t\tthis.checkRecursive = true;\r\n\t\tthis.scanned = [];\r\n\t\tthis.scannedFrozen = [];\r\n\t\tthis.scannedFrozenSchemas = [];\r\n\t\tthis.scannedFrozenValidationErrors = [];\r\n\t\tthis.validatedSchemasKey = 'tv4_validation_id';\r\n\t\tthis.validationErrorsKey = 'tv4_validation_errors_id';\r\n\t}\r\n\tif (trackUnknownProperties) {\r\n\t\tthis.trackUnknownProperties = true;\r\n\t\tthis.knownPropertyPaths = {};\r\n\t\tthis.unknownPropertyPaths = {};\r\n\t}\r\n\tthis.errorReporter = errorReporter || defaultErrorReporter('en');\r\n\tif (typeof this.errorReporter === 'string') {\r\n\t\tthrow new Error('debug');\r\n\t}\r\n\tthis.definedKeywords = {};\r\n\tif (parent) {\r\n\t\tfor (var key in parent.definedKeywords) {\r\n\t\t\tthis.definedKeywords[key] = parent.definedKeywords[key].slice(0);\r\n\t\t}\r\n\t}\r\n};\r\nValidatorContext.prototype.defineKeyword = function (keyword, keywordFunction) {\r\n\tthis.definedKeywords[keyword] = this.definedKeywords[keyword] || [];\r\n\tthis.definedKeywords[keyword].push(keywordFunction);\r\n};\r\nValidatorContext.prototype.createError = function (code, messageParams, dataPath, schemaPath, subErrors, data, schema) {\r\n\tvar error = new ValidationError(code, messageParams, dataPath, schemaPath, subErrors);\r\n\terror.message = this.errorReporter(error, data, schema);\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.returnError = function (error) {\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.collectError = function (error) {\r\n\tif (error) {\r\n\t\tthis.errors.push(error);\r\n\t}\r\n\treturn null;\r\n};\r\nValidatorContext.prototype.prefixErrors = function (startIndex, dataPath, schemaPath) {\r\n\tfor (var i = startIndex; i < this.errors.length; i++) {\r\n\t\tthis.errors[i] = this.errors[i].prefixWith(dataPath, schemaPath);\r\n\t}\r\n\treturn this;\r\n};\r\nValidatorContext.prototype.banUnknownProperties = function (data, schema) {\r\n\tfor (var unknownPath in this.unknownPropertyPaths) {\r\n\t\tvar error = this.createError(ErrorCodes.UNKNOWN_PROPERTY, {path: unknownPath}, unknownPath, \"\", null, data, schema);\r\n\t\tvar result = this.handleError(error);\r\n\t\tif (result) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.addFormat = function (format, validator) {\r\n\tif (typeof format === 'object') {\r\n\t\tfor (var key in format) {\r\n\t\t\tthis.addFormat(key, format[key]);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\tthis.formatValidators[format] = validator;\r\n};\r\nValidatorContext.prototype.resolveRefs = function (schema, urlHistory) {\r\n\tif (schema['$ref'] !== undefined) {\r\n\t\turlHistory = urlHistory || {};\r\n\t\tif (urlHistory[schema['$ref']]) {\r\n\t\t\treturn this.createError(ErrorCodes.CIRCULAR_REFERENCE, {urls: Object.keys(urlHistory).join(', ')}, '', '', null, undefined, schema);\r\n\t\t}\r\n\t\turlHistory[schema['$ref']] = true;\r\n\t\tschema = this.getSchema(schema['$ref'], urlHistory);\r\n\t}\r\n\treturn schema;\r\n};\r\nValidatorContext.prototype.getSchema = function (url, urlHistory) {\r\n\tvar schema;\r\n\tif (this.schemas[url] !== undefined) {\r\n\t\tschema = this.schemas[url];\r\n\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t}\r\n\tvar baseUrl = url;\r\n\tvar fragment = \"\";\r\n\tif (url.indexOf('#') !== -1) {\r\n\t\tfragment = url.substring(url.indexOf(\"#\") + 1);\r\n\t\tbaseUrl = url.substring(0, url.indexOf(\"#\"));\r\n\t}\r\n\tif (typeof this.schemas[baseUrl] === 'object') {\r\n\t\tschema = this.schemas[baseUrl];\r\n\t\tvar pointerPath = decodeURIComponent(fragment);\r\n\t\tif (pointerPath === \"\") {\r\n\t\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t\t} else if (pointerPath.charAt(0) !== \"/\") {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar parts = pointerPath.split(\"/\").slice(1);\r\n\t\tfor (var i = 0; i < parts.length; i++) {\r\n\t\t\tvar component = parts[i].replace(/~1/g, \"/\").replace(/~0/g, \"~\");\r\n\t\t\tif (schema[component] === undefined) {\r\n\t\t\t\tschema = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tschema = schema[component];\r\n\t\t}\r\n\t\tif (schema !== undefined) {\r\n\t\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t\t}\r\n\t}\r\n\tif (this.missing[baseUrl] === undefined) {\r\n\t\tthis.missing.push(baseUrl);\r\n\t\tthis.missing[baseUrl] = baseUrl;\r\n\t\tthis.missingMap[baseUrl] = baseUrl;\r\n\t}\r\n};\r\nValidatorContext.prototype.searchSchemas = function (schema, url) {\r\n\tif (Array.isArray(schema)) {\r\n\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\tthis.searchSchemas(schema[i], url);\r\n\t\t}\r\n\t} else if (schema && typeof schema === \"object\") {\r\n\t\tif (typeof schema.id === \"string\") {\r\n\t\t\tif (isTrustedUrl(url, schema.id)) {\r\n\t\t\t\tif (this.schemas[schema.id] === undefined) {\r\n\t\t\t\t\tthis.schemas[schema.id] = schema;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var key in schema) {\r\n\t\t\tif (key !== \"enum\") {\r\n\t\t\t\tif (typeof schema[key] === \"object\") {\r\n\t\t\t\t\tthis.searchSchemas(schema[key], url);\r\n\t\t\t\t} else if (key === \"$ref\") {\r\n\t\t\t\t\tvar uri = getDocumentUri(schema[key]);\r\n\t\t\t\t\tif (uri && this.schemas[uri] === undefined && this.missingMap[uri] === undefined) {\r\n\t\t\t\t\t\tthis.missingMap[uri] = uri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\nValidatorContext.prototype.addSchema = function (url, schema) {\r\n\t//overload\r\n\tif (typeof url !== 'string' || typeof schema === 'undefined') {\r\n\t\tif (typeof url === 'object' && typeof url.id === 'string') {\r\n\t\t\tschema = url;\r\n\t\t\turl = schema.id;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tif (url === getDocumentUri(url) + \"#\") {\r\n\t\t// Remove empty fragment\r\n\t\turl = getDocumentUri(url);\r\n\t}\r\n\tthis.schemas[url] = schema;\r\n\tdelete this.missingMap[url];\r\n\tnormSchema(schema, url);\r\n\tthis.searchSchemas(schema, url);\r\n};\r\n\r\nValidatorContext.prototype.getSchemaMap = function () {\r\n\tvar map = {};\r\n\tfor (var key in this.schemas) {\r\n\t\tmap[key] = this.schemas[key];\r\n\t}\r\n\treturn map;\r\n};\r\n\r\nValidatorContext.prototype.getSchemaUris = function (filterRegExp) {\r\n\tvar list = [];\r\n\tfor (var key in this.schemas) {\r\n\t\tif (!filterRegExp || filterRegExp.test(key)) {\r\n\t\t\tlist.push(key);\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n};\r\n\r\nValidatorContext.prototype.getMissingUris = function (filterRegExp) {\r\n\tvar list = [];\r\n\tfor (var key in this.missingMap) {\r\n\t\tif (!filterRegExp || filterRegExp.test(key)) {\r\n\t\t\tlist.push(key);\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n};\r\n\r\nValidatorContext.prototype.dropSchemas = function () {\r\n\tthis.schemas = {};\r\n\tthis.reset();\r\n};\r\nValidatorContext.prototype.reset = function () {\r\n\tthis.missing = [];\r\n\tthis.missingMap = {};\r\n\tthis.errors = [];\r\n};\r\n\r\nValidatorContext.prototype.validateAll = function (data, schema, dataPathParts, schemaPathParts, dataPointerPath) {\r\n\tvar topLevel;\r\n\tschema = this.resolveRefs(schema);\r\n\tif (!schema) {\r\n\t\treturn null;\r\n\t} else if (schema instanceof ValidationError) {\r\n\t\tthis.errors.push(schema);\r\n\t\treturn schema;\r\n\t}\r\n\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar frozenIndex, scannedFrozenSchemaIndex = null, scannedSchemasIndex = null;\r\n\tif (this.checkRecursive && data && typeof data === 'object') {\r\n\t\ttopLevel = !this.scanned.length;\r\n\t\tif (data[this.validatedSchemasKey]) {\r\n\t\t\tvar schemaIndex = data[this.validatedSchemasKey].indexOf(schema);\r\n\t\t\tif (schemaIndex !== -1) {\r\n\t\t\t\tthis.errors = this.errors.concat(data[this.validationErrorsKey][schemaIndex]);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.isFrozen(data)) {\r\n\t\t\tfrozenIndex = this.scannedFrozen.indexOf(data);\r\n\t\t\tif (frozenIndex !== -1) {\r\n\t\t\t\tvar frozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].indexOf(schema);\r\n\t\t\t\tif (frozenSchemaIndex !== -1) {\r\n\t\t\t\t\tthis.errors = this.errors.concat(this.scannedFrozenValidationErrors[frozenIndex][frozenSchemaIndex]);\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.scanned.push(data);\r\n\t\tif (Object.isFrozen(data)) {\r\n\t\t\tif (frozenIndex === -1) {\r\n\t\t\t\tfrozenIndex = this.scannedFrozen.length;\r\n\t\t\t\tthis.scannedFrozen.push(data);\r\n\t\t\t\tthis.scannedFrozenSchemas.push([]);\r\n\t\t\t}\r\n\t\t\tscannedFrozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].length;\r\n\t\t\tthis.scannedFrozenSchemas[frozenIndex][scannedFrozenSchemaIndex] = schema;\r\n\t\t\tthis.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = [];\r\n\t\t} else {\r\n\t\t\tif (!data[this.validatedSchemasKey]) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tObject.defineProperty(data, this.validatedSchemasKey, {\r\n\t\t\t\t\t\tvalue: [],\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\tObject.defineProperty(data, this.validationErrorsKey, {\r\n\t\t\t\t\t\tvalue: [],\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t//IE 7/8 workaround\r\n\t\t\t\t\tdata[this.validatedSchemasKey] = [];\r\n\t\t\t\t\tdata[this.validationErrorsKey] = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tscannedSchemasIndex = data[this.validatedSchemasKey].length;\r\n\t\t\tdata[this.validatedSchemasKey][scannedSchemasIndex] = schema;\r\n\t\t\tdata[this.validationErrorsKey][scannedSchemasIndex] = [];\r\n\t\t}\r\n\t}\r\n\r\n\tvar errorCount = this.errors.length;\r\n\tvar error = this.validateBasic(data, schema, dataPointerPath)\r\n\t\t|| this.validateNumeric(data, schema, dataPointerPath)\r\n\t\t|| this.validateString(data, schema, dataPointerPath)\r\n\t\t|| this.validateArray(data, schema, dataPointerPath)\r\n\t\t|| this.validateObject(data, schema, dataPointerPath)\r\n\t\t|| this.validateCombinations(data, schema, dataPointerPath)\r\n\t\t|| this.validateHypermedia(data, schema, dataPointerPath)\r\n\t\t|| this.validateFormat(data, schema, dataPointerPath)\r\n\t\t|| this.validateDefinedKeywords(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n\r\n\tif (topLevel) {\r\n\t\twhile (this.scanned.length) {\r\n\t\t\tvar item = this.scanned.pop();\r\n\t\t\tdelete item[this.validatedSchemasKey];\r\n\t\t}\r\n\t\tthis.scannedFrozen = [];\r\n\t\tthis.scannedFrozenSchemas = [];\r\n\t}\r\n\r\n\tif (error || errorCount !== this.errors.length) {\r\n\t\twhile ((dataPathParts && dataPathParts.length) || (schemaPathParts && schemaPathParts.length)) {\r\n\t\t\tvar dataPart = (dataPathParts && dataPathParts.length) ? \"\" + dataPathParts.pop() : null;\r\n\t\t\tvar schemaPart = (schemaPathParts && schemaPathParts.length) ? \"\" + schemaPathParts.pop() : null;\r\n\t\t\tif (error) {\r\n\t\t\t\terror = error.prefixWith(dataPart, schemaPart);\r\n\t\t\t}\r\n\t\t\tthis.prefixErrors(errorCount, dataPart, schemaPart);\r\n\t\t}\r\n\t}\r\n\r\n\tif (scannedFrozenSchemaIndex !== null) {\r\n\t\tthis.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = this.errors.slice(startErrorCount);\r\n\t} else if (scannedSchemasIndex !== null) {\r\n\t\tdata[this.validationErrorsKey][scannedSchemasIndex] = this.errors.slice(startErrorCount);\r\n\t}\r\n\r\n\treturn this.handleError(error);\r\n};\r\nValidatorContext.prototype.validateFormat = function (data, schema) {\r\n\tif (typeof schema.format !== 'string' || !this.formatValidators[schema.format]) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errorMessage = this.formatValidators[schema.format].call(null, data, schema);\r\n\tif (typeof errorMessage === 'string' || typeof errorMessage === 'number') {\r\n\t\treturn this.createError(ErrorCodes.FORMAT_CUSTOM, {message: errorMessage}, '', '/format', null, data, schema);\r\n\t} else if (errorMessage && typeof errorMessage === 'object') {\r\n\t\treturn this.createError(ErrorCodes.FORMAT_CUSTOM, {message: errorMessage.message || \"?\"}, errorMessage.dataPath || '', errorMessage.schemaPath || \"/format\", null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\nValidatorContext.prototype.validateDefinedKeywords = function (data, schema, dataPointerPath) {\r\n\tfor (var key in this.definedKeywords) {\r\n\t\tif (typeof schema[key] === 'undefined') {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tvar validationFunctions = this.definedKeywords[key];\r\n\t\tfor (var i = 0; i < validationFunctions.length; i++) {\r\n\t\t\tvar func = validationFunctions[i];\r\n\t\t\tvar result = func(data, schema[key], schema, dataPointerPath);\r\n\t\t\tif (typeof result === 'string' || typeof result === 'number') {\r\n\t\t\t\treturn this.createError(ErrorCodes.KEYWORD_CUSTOM, {key: key, message: result}, '', '', null, data, schema).prefixWith(null, key);\r\n\t\t\t} else if (result && typeof result === 'object') {\r\n\t\t\t\tvar code = result.code;\r\n\t\t\t\tif (typeof code === 'string') {\r\n\t\t\t\t\tif (!ErrorCodes[code]) {\r\n\t\t\t\t\t\tthrow new Error('Undefined error code (use defineError): ' + code);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcode = ErrorCodes[code];\r\n\t\t\t\t} else if (typeof code !== 'number') {\r\n\t\t\t\t\tcode = ErrorCodes.KEYWORD_CUSTOM;\r\n\t\t\t\t}\r\n\t\t\t\tvar messageParams = (typeof result.message === 'object') ? result.message : {key: key, message: result.message || \"?\"};\r\n\t\t\t\tvar schemaPath = result.schemaPath || (\"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1'));\r\n\t\t\t\treturn this.createError(code, messageParams, result.dataPath || null, schemaPath, null, data, schema);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nfunction recursiveCompare(A, B) {\r\n\tif (A === B) {\r\n\t\treturn true;\r\n\t}\r\n\tif (A && B && typeof A === \"object\" && typeof B === \"object\") {\r\n\t\tif (Array.isArray(A) !== Array.isArray(B)) {\r\n\t\t\treturn false;\r\n\t\t} else if (Array.isArray(A)) {\r\n\t\t\tif (A.length !== B.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < A.length; i++) {\r\n\t\t\t\tif (!recursiveCompare(A[i], B[i])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar key;\r\n\t\t\tfor (key in A) {\r\n\t\t\t\tif (B[key] === undefined && A[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (key in B) {\r\n\t\t\t\tif (A[key] === undefined && B[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (key in A) {\r\n\t\t\t\tif (!recursiveCompare(A[key], B[key])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValidatorContext.prototype.validateBasic = function validateBasic(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tif (error = this.validateType(data, schema, dataPointerPath)) {\r\n\t\treturn error.prefixWith(null, \"type\");\r\n\t}\r\n\tif (error = this.validateEnum(data, schema, dataPointerPath)) {\r\n\t\treturn error.prefixWith(null, \"type\");\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateType = function validateType(data, schema) {\r\n\tif (schema.type === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar dataType = typeof data;\r\n\tif (data === null) {\r\n\t\tdataType = \"null\";\r\n\t} else if (Array.isArray(data)) {\r\n\t\tdataType = \"array\";\r\n\t}\r\n\tvar allowedTypes = schema.type;\r\n\tif (!Array.isArray(allowedTypes)) {\r\n\t\tallowedTypes = [allowedTypes];\r\n\t}\r\n\r\n\tfor (var i = 0; i < allowedTypes.length; i++) {\r\n\t\tvar type = allowedTypes[i];\r\n\t\tif (type === dataType || (type === \"integer\" && dataType === \"number\" && (data % 1 === 0))) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn this.createError(ErrorCodes.INVALID_TYPE, {type: dataType, expected: allowedTypes.join(\"/\")}, '', '', null, data, schema);\r\n};\r\n\r\nValidatorContext.prototype.validateEnum = function validateEnum(data, schema) {\r\n\tif (schema[\"enum\"] === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tfor (var i = 0; i < schema[\"enum\"].length; i++) {\r\n\t\tvar enumVal = schema[\"enum\"][i];\r\n\t\tif (recursiveCompare(data, enumVal)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn this.createError(ErrorCodes.ENUM_MISMATCH, {value: (typeof JSON !== 'undefined') ? JSON.stringify(data) : data}, '', '', null, data, schema);\r\n};\r\n\r\nValidatorContext.prototype.validateNumeric = function validateNumeric(data, schema, dataPointerPath) {\r\n\treturn this.validateMultipleOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateMinMax(data, schema, dataPointerPath)\r\n\t\t|| this.validateNaN(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nvar CLOSE_ENOUGH_LOW = Math.pow(2, -51);\r\nvar CLOSE_ENOUGH_HIGH = 1 - CLOSE_ENOUGH_LOW;\r\nValidatorContext.prototype.validateMultipleOf = function validateMultipleOf(data, schema) {\r\n\tvar multipleOf = schema.multipleOf || schema.divisibleBy;\r\n\tif (multipleOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tif (typeof data === \"number\") {\r\n\t\tvar remainder = (data/multipleOf)%1;\r\n\t\tif (remainder >= CLOSE_ENOUGH_LOW && remainder < CLOSE_ENOUGH_HIGH) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MULTIPLE_OF, {value: data, multipleOf: multipleOf}, '', '', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateMinMax = function validateMinMax(data, schema) {\r\n\tif (typeof data !== \"number\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minimum !== undefined) {\r\n\t\tif (data < schema.minimum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MINIMUM, {value: data, minimum: schema.minimum}, '', '/minimum', null, data, schema);\r\n\t\t}\r\n\t\tif (schema.exclusiveMinimum && data === schema.minimum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MINIMUM_EXCLUSIVE, {value: data, minimum: schema.minimum}, '', '/exclusiveMinimum', null, data, schema);\r\n\t\t}\r\n\t}\r\n\tif (schema.maximum !== undefined) {\r\n\t\tif (data > schema.maximum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MAXIMUM, {value: data, maximum: schema.maximum}, '', '/maximum', null, data, schema);\r\n\t\t}\r\n\t\tif (schema.exclusiveMaximum && data === schema.maximum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MAXIMUM_EXCLUSIVE, {value: data, maximum: schema.maximum}, '', '/exclusiveMaximum', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateNaN = function validateNaN(data, schema) {\r\n\tif (typeof data !== \"number\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (isNaN(data) === true || data === Infinity || data === -Infinity) {\r\n\t\treturn this.createError(ErrorCodes.NUMBER_NOT_A_NUMBER, {value: data}, '', '/type', null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateString = function validateString(data, schema, dataPointerPath) {\r\n\treturn this.validateStringLength(data, schema, dataPointerPath)\r\n\t\t|| this.validateStringPattern(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateStringLength = function validateStringLength(data, schema) {\r\n\tif (typeof data !== \"string\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minLength !== undefined) {\r\n\t\tif (data.length < schema.minLength) {\r\n\t\t\treturn this.createError(ErrorCodes.STRING_LENGTH_SHORT, {length: data.length, minimum: schema.minLength}, '', '/minLength', null, data, schema);\r\n\t\t}\r\n\t}\r\n\tif (schema.maxLength !== undefined) {\r\n\t\tif (data.length > schema.maxLength) {\r\n\t\t\treturn this.createError(ErrorCodes.STRING_LENGTH_LONG, {length: data.length, maximum: schema.maxLength}, '', '/maxLength', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateStringPattern = function validateStringPattern(data, schema) {\r\n\tif (typeof data !== \"string\" || (typeof schema.pattern !== \"string\" && !(schema.pattern instanceof RegExp))) {\r\n\t\treturn null;\r\n\t}\r\n\tvar regexp;\r\n\tif (schema.pattern instanceof RegExp) {\r\n\t  regexp = schema.pattern;\r\n\t}\r\n\telse {\r\n\t  var body, flags = '';\r\n\t  // Check for regular expression literals\r\n\t  // @see http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.5\r\n\t  var literal = schema.pattern.match(/^\\/(.+)\\/([img]*)$/);\r\n\t  if (literal) {\r\n\t    body = literal[1];\r\n\t    flags = literal[2];\r\n\t  }\r\n\t  else {\r\n\t    body = schema.pattern;\r\n\t  }\r\n\t  regexp = new RegExp(body, flags);\r\n\t}\r\n\tif (!regexp.test(data)) {\r\n\t\treturn this.createError(ErrorCodes.STRING_PATTERN, {pattern: schema.pattern}, '', '/pattern', null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArray = function validateArray(data, schema, dataPointerPath) {\r\n\tif (!Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateArrayLength(data, schema, dataPointerPath)\r\n\t\t|| this.validateArrayUniqueItems(data, schema, dataPointerPath)\r\n\t\t|| this.validateArrayItems(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayLength = function validateArrayLength(data, schema) {\r\n\tvar error;\r\n\tif (schema.minItems !== undefined) {\r\n\t\tif (data.length < schema.minItems) {\r\n\t\t\terror = this.createError(ErrorCodes.ARRAY_LENGTH_SHORT, {length: data.length, minimum: schema.minItems}, '', '/minItems', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxItems !== undefined) {\r\n\t\tif (data.length > schema.maxItems) {\r\n\t\t\terror = this.createError(ErrorCodes.ARRAY_LENGTH_LONG, {length: data.length, maximum: schema.maxItems}, '', '/maxItems', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayUniqueItems = function validateArrayUniqueItems(data, schema) {\r\n\tif (schema.uniqueItems) {\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\tfor (var j = i + 1; j < data.length; j++) {\r\n\t\t\t\tif (recursiveCompare(data[i], data[j])) {\r\n\t\t\t\t\tvar error = this.createError(ErrorCodes.ARRAY_UNIQUE, {match1: i, match2: j}, '', '/uniqueItems', null, data, schema);\r\n\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayItems = function validateArrayItems(data, schema, dataPointerPath) {\r\n\tif (schema.items === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error, i;\r\n\tif (Array.isArray(schema.items)) {\r\n\t\tfor (i = 0; i < data.length; i++) {\r\n\t\t\tif (i < schema.items.length) {\r\n\t\t\t\tif (error = this.validateAll(data[i], schema.items[i], [i], [\"items\", i], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t} else if (schema.additionalItems !== undefined) {\r\n\t\t\t\tif (typeof schema.additionalItems === \"boolean\") {\r\n\t\t\t\t\tif (!schema.additionalItems) {\r\n\t\t\t\t\t\terror = (this.createError(ErrorCodes.ARRAY_ADDITIONAL_ITEMS, {}, '/' + i, '/additionalItems', null, data, schema));\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (error = this.validateAll(data[i], schema.additionalItems, [i], [\"additionalItems\"], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (i = 0; i < data.length; i++) {\r\n\t\t\tif (error = this.validateAll(data[i], schema.items, [i], [\"items\"], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObject = function validateObject(data, schema, dataPointerPath) {\r\n\tif (typeof data !== \"object\" || data === null || Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateObjectMinMaxProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectRequiredProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectDependencies(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectMinMaxProperties = function validateObjectMinMaxProperties(data, schema) {\r\n\tvar keys = Object.keys(data);\r\n\tvar error;\r\n\tif (schema.minProperties !== undefined) {\r\n\t\tif (keys.length < schema.minProperties) {\r\n\t\t\terror = this.createError(ErrorCodes.OBJECT_PROPERTIES_MINIMUM, {propertyCount: keys.length, minimum: schema.minProperties}, '', '/minProperties', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxProperties !== undefined) {\r\n\t\tif (keys.length > schema.maxProperties) {\r\n\t\t\terror = this.createError(ErrorCodes.OBJECT_PROPERTIES_MAXIMUM, {propertyCount: keys.length, maximum: schema.maxProperties}, '', '/maxProperties', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectRequiredProperties = function validateObjectRequiredProperties(data, schema) {\r\n\tif (schema.required !== undefined) {\r\n\t\tfor (var i = 0; i < schema.required.length; i++) {\r\n\t\t\tvar key = schema.required[i];\r\n\t\t\tif (data[key] === undefined) {\r\n\t\t\t\tvar error = this.createError(ErrorCodes.OBJECT_REQUIRED, {key: key}, '', '/required/' + i, null, data, schema);\r\n\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectProperties = function validateObjectProperties(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tfor (var key in data) {\r\n\t\tvar keyPointerPath = dataPointerPath + \"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1');\r\n\t\tvar foundMatch = false;\r\n\t\tif (schema.properties !== undefined && schema.properties[key] !== undefined) {\r\n\t\t\tfoundMatch = true;\r\n\t\t\tif (error = this.validateAll(data[key], schema.properties[key], [key], [\"properties\", key], keyPointerPath)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (schema.patternProperties !== undefined) {\r\n\t\t\tfor (var patternKey in schema.patternProperties) {\r\n\t\t\t\tvar regexp = new RegExp(patternKey);\r\n\t\t\t\tif (regexp.test(key)) {\r\n\t\t\t\t\tfoundMatch = true;\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.patternProperties[patternKey], [key], [\"patternProperties\", patternKey], keyPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!foundMatch) {\r\n\t\t\tif (schema.additionalProperties !== undefined) {\r\n\t\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\t\tthis.knownPropertyPaths[keyPointerPath] = true;\r\n\t\t\t\t\tdelete this.unknownPropertyPaths[keyPointerPath];\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof schema.additionalProperties === \"boolean\") {\r\n\t\t\t\t\tif (!schema.additionalProperties) {\r\n\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_ADDITIONAL_PROPERTIES, {key: key}, '', '/additionalProperties', null, data, schema).prefixWith(key, null);\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.additionalProperties, [key], [\"additionalProperties\"], keyPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (this.trackUnknownProperties && !this.knownPropertyPaths[keyPointerPath]) {\r\n\t\t\t\tthis.unknownPropertyPaths[keyPointerPath] = true;\r\n\t\t\t}\r\n\t\t} else if (this.trackUnknownProperties) {\r\n\t\t\tthis.knownPropertyPaths[keyPointerPath] = true;\r\n\t\t\tdelete this.unknownPropertyPaths[keyPointerPath];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectDependencies = function validateObjectDependencies(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tif (schema.dependencies !== undefined) {\r\n\t\tfor (var depKey in schema.dependencies) {\r\n\t\t\tif (data[depKey] !== undefined) {\r\n\t\t\t\tvar dep = schema.dependencies[depKey];\r\n\t\t\t\tif (typeof dep === \"string\") {\r\n\t\t\t\t\tif (data[dep] === undefined) {\r\n\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {key: depKey, missing: dep}, '', '', null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (Array.isArray(dep)) {\r\n\t\t\t\t\tfor (var i = 0; i < dep.length; i++) {\r\n\t\t\t\t\t\tvar requiredKey = dep[i];\r\n\t\t\t\t\t\tif (data[requiredKey] === undefined) {\r\n\t\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {key: depKey, missing: requiredKey}, '', '/' + i, null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\r\n\t\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data, dep, [], [\"dependencies\", depKey], dataPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateCombinations = function validateCombinations(data, schema, dataPointerPath) {\r\n\treturn this.validateAllOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateAnyOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateOneOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateNot(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateAllOf = function validateAllOf(data, schema, dataPointerPath) {\r\n\tif (schema.allOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.allOf.length; i++) {\r\n\t\tvar subSchema = schema.allOf[i];\r\n\t\tif (error = this.validateAll(data, subSchema, [], [\"allOf\", i], dataPointerPath)) {\r\n\t\t\treturn error;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateAnyOf = function validateAnyOf(data, schema, dataPointerPath) {\r\n\tif (schema.anyOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t}\r\n\tvar errorAtEnd = true;\r\n\tfor (var i = 0; i < schema.anyOf.length; i++) {\r\n\t\tif (this.trackUnknownProperties) {\r\n\t\t\tthis.unknownPropertyPaths = {};\r\n\t\t\tthis.knownPropertyPaths = {};\r\n\t\t}\r\n\t\tvar subSchema = schema.anyOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], [\"anyOf\", i], dataPointerPath);\r\n\r\n\t\tif (error === null && errorCount === this.errors.length) {\r\n\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\r\n\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\tfor (var knownKey in this.knownPropertyPaths) {\r\n\t\t\t\t\toldKnownPropertyPaths[knownKey] = true;\r\n\t\t\t\t\tdelete oldUnknownPropertyPaths[knownKey];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var unknownKey in this.unknownPropertyPaths) {\r\n\t\t\t\t\tif (!oldKnownPropertyPaths[unknownKey]) {\r\n\t\t\t\t\t\toldUnknownPropertyPaths[unknownKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// We need to continue looping so we catch all the property definitions, but we don't want to return an error\r\n\t\t\t\terrorAtEnd = false;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (error) {\r\n\t\t\terrors.push(error.prefixWith(null, \"\" + i).prefixWith(null, \"anyOf\"));\r\n\t\t}\r\n\t}\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (errorAtEnd) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn this.createError(ErrorCodes.ANY_OF_MISSING, {}, \"\", \"/anyOf\", errors, data, schema);\r\n\t}\r\n};\r\n\r\nValidatorContext.prototype.validateOneOf = function validateOneOf(data, schema, dataPointerPath) {\r\n\tif (schema.oneOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar validIndex = null;\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t}\r\n\tfor (var i = 0; i < schema.oneOf.length; i++) {\r\n\t\tif (this.trackUnknownProperties) {\r\n\t\t\tthis.unknownPropertyPaths = {};\r\n\t\t\tthis.knownPropertyPaths = {};\r\n\t\t}\r\n\t\tvar subSchema = schema.oneOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], [\"oneOf\", i], dataPointerPath);\r\n\r\n\t\tif (error === null && errorCount === this.errors.length) {\r\n\t\t\tif (validIndex === null) {\r\n\t\t\t\tvalidIndex = i;\r\n\t\t\t} else {\r\n\t\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\t\t\treturn this.createError(ErrorCodes.ONE_OF_MULTIPLE, {index1: validIndex, index2: i}, \"\", \"/oneOf\", null, data, schema);\r\n\t\t\t}\r\n\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\tfor (var knownKey in this.knownPropertyPaths) {\r\n\t\t\t\t\toldKnownPropertyPaths[knownKey] = true;\r\n\t\t\t\t\tdelete oldUnknownPropertyPaths[knownKey];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var unknownKey in this.unknownPropertyPaths) {\r\n\t\t\t\t\tif (!oldKnownPropertyPaths[unknownKey]) {\r\n\t\t\t\t\t\toldUnknownPropertyPaths[unknownKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (error) {\r\n\t\t\terrors.push(error);\r\n\t\t}\r\n\t}\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (validIndex === null) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn this.createError(ErrorCodes.ONE_OF_MISSING, {}, \"\", \"/oneOf\", errors, data, schema);\r\n\t} else {\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateNot = function validateNot(data, schema, dataPointerPath) {\r\n\tif (schema.not === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar oldErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t\tthis.unknownPropertyPaths = {};\r\n\t\tthis.knownPropertyPaths = {};\r\n\t}\r\n\tvar error = this.validateAll(data, schema.not, null, null, dataPointerPath);\r\n\tvar notErrors = this.errors.slice(oldErrorCount);\r\n\tthis.errors = this.errors.slice(0, oldErrorCount);\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (error === null && notErrors.length === 0) {\r\n\t\treturn this.createError(ErrorCodes.NOT_PASSED, {}, \"\", \"/not\", null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateHypermedia = function validateCombinations(data, schema, dataPointerPath) {\r\n\tif (!schema.links) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.links.length; i++) {\r\n\t\tvar ldo = schema.links[i];\r\n\t\tif (ldo.rel === \"describedby\") {\r\n\t\t\tvar template = new UriTemplate(ldo.href);\r\n\t\t\tvar allPresent = true;\r\n\t\t\tfor (var j = 0; j < template.varNames.length; j++) {\r\n\t\t\t\tif (!(template.varNames[j] in data)) {\r\n\t\t\t\t\tallPresent = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (allPresent) {\r\n\t\t\t\tvar schemaUrl = template.fillFromObject(data);\r\n\t\t\t\tvar subSchema = {\"$ref\": schemaUrl};\r\n\t\t\t\tif (error = this.validateAll(data, subSchema, [], [\"links\", i], dataPointerPath)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// parseURI() and resolveUrl() are from https://gist.github.com/1088850\r\n//   -  released as public domain by author (\"Yaffle\") - see comments on gist\r\n\r\nfunction parseURI(url) {\r\n\tvar m = String(url).replace(/^\\s+|\\s+$/g, '').match(/^([^:\\/?#]+:)?(\\/\\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\\/?#]*)(?::(\\d*))?))?([^?#]*)(\\?[^#]*)?(#[\\s\\S]*)?/);\r\n\t// authority = '//' + user + ':' + pass '@' + hostname + ':' port\r\n\treturn (m ? {\r\n\t\thref     : m[0] || '',\r\n\t\tprotocol : m[1] || '',\r\n\t\tauthority: m[2] || '',\r\n\t\thost     : m[3] || '',\r\n\t\thostname : m[4] || '',\r\n\t\tport     : m[5] || '',\r\n\t\tpathname : m[6] || '',\r\n\t\tsearch   : m[7] || '',\r\n\t\thash     : m[8] || ''\r\n\t} : null);\r\n}\r\n\r\nfunction resolveUrl(base, href) {// RFC 3986\r\n\r\n\tfunction removeDotSegments(input) {\r\n\t\tvar output = [];\r\n\t\tinput.replace(/^(\\.\\.?(\\/|$))+/, '')\r\n\t\t\t.replace(/\\/(\\.(\\/|$))+/g, '/')\r\n\t\t\t.replace(/\\/\\.\\.$/, '/../')\r\n\t\t\t.replace(/\\/?[^\\/]*/g, function (p) {\r\n\t\t\t\tif (p === '/..') {\r\n\t\t\t\t\toutput.pop();\r\n\t\t\t\t} else {\r\n\t\t\t\t\toutput.push(p);\r\n\t\t\t\t}\r\n\t\t});\r\n\t\treturn output.join('').replace(/^\\//, input.charAt(0) === '/' ? '/' : '');\r\n\t}\r\n\r\n\thref = parseURI(href || '');\r\n\tbase = parseURI(base || '');\r\n\r\n\treturn !href || !base ? null : (href.protocol || base.protocol) +\r\n\t\t(href.protocol || href.authority ? href.authority : base.authority) +\r\n\t\tremoveDotSegments(href.protocol || href.authority || href.pathname.charAt(0) === '/' ? href.pathname : (href.pathname ? ((base.authority && !base.pathname ? '/' : '') + base.pathname.slice(0, base.pathname.lastIndexOf('/') + 1) + href.pathname) : base.pathname)) +\r\n\t\t(href.protocol || href.authority || href.pathname ? href.search : (href.search || base.search)) +\r\n\t\thref.hash;\r\n}\r\n\r\nfunction getDocumentUri(uri) {\r\n\treturn uri.split('#')[0];\r\n}\r\nfunction normSchema(schema, baseUri) {\r\n\tif (schema && typeof schema === \"object\") {\r\n\t\tif (baseUri === undefined) {\r\n\t\t\tbaseUri = schema.id;\r\n\t\t} else if (typeof schema.id === \"string\") {\r\n\t\t\tbaseUri = resolveUrl(baseUri, schema.id);\r\n\t\t\tschema.id = baseUri;\r\n\t\t}\r\n\t\tif (Array.isArray(schema)) {\r\n\t\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\t\tnormSchema(schema[i], baseUri);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (typeof schema['$ref'] === \"string\") {\r\n\t\t\t\tschema['$ref'] = resolveUrl(baseUri, schema['$ref']);\r\n\t\t\t}\r\n\t\t\tfor (var key in schema) {\r\n\t\t\t\tif (key !== \"enum\") {\r\n\t\t\t\t\tnormSchema(schema[key], baseUri);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction defaultErrorReporter(language) {\r\n\tlanguage = language || 'en';\r\n\r\n\tvar errorMessages = languages[language];\r\n\r\n\treturn function (error) {\r\n\t\tvar messageTemplate = errorMessages[error.code] || ErrorMessagesDefault[error.code];\r\n\t\tif (typeof messageTemplate !== 'string') {\r\n\t\t\treturn \"Unknown error code \" + error.code + \": \" + JSON.stringify(error.messageParams);\r\n\t\t}\r\n\t\tvar messageParams = error.params;\r\n\t\t// Adapted from Crockford's supplant()\r\n\t\treturn messageTemplate.replace(/\\{([^{}]*)\\}/g, function (whole, varName) {\r\n\t\t\tvar subValue = messageParams[varName];\r\n\t\t\treturn typeof subValue === 'string' || typeof subValue === 'number' ? subValue : whole;\r\n\t\t});\r\n\t};\r\n}\r\n\r\nvar ErrorCodes = {\r\n\tINVALID_TYPE: 0,\r\n\tENUM_MISMATCH: 1,\r\n\tANY_OF_MISSING: 10,\r\n\tONE_OF_MISSING: 11,\r\n\tONE_OF_MULTIPLE: 12,\r\n\tNOT_PASSED: 13,\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: 100,\r\n\tNUMBER_MINIMUM: 101,\r\n\tNUMBER_MINIMUM_EXCLUSIVE: 102,\r\n\tNUMBER_MAXIMUM: 103,\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: 104,\r\n\tNUMBER_NOT_A_NUMBER: 105,\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: 200,\r\n\tSTRING_LENGTH_LONG: 201,\r\n\tSTRING_PATTERN: 202,\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: 300,\r\n\tOBJECT_PROPERTIES_MAXIMUM: 301,\r\n\tOBJECT_REQUIRED: 302,\r\n\tOBJECT_ADDITIONAL_PROPERTIES: 303,\r\n\tOBJECT_DEPENDENCY_KEY: 304,\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: 400,\r\n\tARRAY_LENGTH_LONG: 401,\r\n\tARRAY_UNIQUE: 402,\r\n\tARRAY_ADDITIONAL_ITEMS: 403,\r\n\t// Custom/user-defined errors\r\n\tFORMAT_CUSTOM: 500,\r\n\tKEYWORD_CUSTOM: 501,\r\n\t// Schema structure\r\n\tCIRCULAR_REFERENCE: 600,\r\n\t// Non-standard validation options\r\n\tUNKNOWN_PROPERTY: 1000\r\n};\r\nvar ErrorCodeLookup = {};\r\nfor (var key in ErrorCodes) {\r\n\tErrorCodeLookup[ErrorCodes[key]] = key;\r\n}\r\nvar ErrorMessagesDefault = {\r\n\tINVALID_TYPE: \"Invalid type: {type} (expected {expected})\",\r\n\tENUM_MISMATCH: \"No enum match for: {value}\",\r\n\tANY_OF_MISSING: \"Data does not match any schemas from \\\"anyOf\\\"\",\r\n\tONE_OF_MISSING: \"Data does not match any schemas from \\\"oneOf\\\"\",\r\n\tONE_OF_MULTIPLE: \"Data is valid against more than one schema from \\\"oneOf\\\": indices {index1} and {index2}\",\r\n\tNOT_PASSED: \"Data matches schema from \\\"not\\\"\",\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: \"Value {value} is not a multiple of {multipleOf}\",\r\n\tNUMBER_MINIMUM: \"Value {value} is less than minimum {minimum}\",\r\n\tNUMBER_MINIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive minimum {minimum}\",\r\n\tNUMBER_MAXIMUM: \"Value {value} is greater than maximum {maximum}\",\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive maximum {maximum}\",\r\n\tNUMBER_NOT_A_NUMBER: \"Value {value} is not a valid number\",\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: \"String is too short ({length} chars), minimum {minimum}\",\r\n\tSTRING_LENGTH_LONG: \"String is too long ({length} chars), maximum {maximum}\",\r\n\tSTRING_PATTERN: \"String does not match pattern: {pattern}\",\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: \"Too few properties defined ({propertyCount}), minimum {minimum}\",\r\n\tOBJECT_PROPERTIES_MAXIMUM: \"Too many properties defined ({propertyCount}), maximum {maximum}\",\r\n\tOBJECT_REQUIRED: \"Missing required property: {key}\",\r\n\tOBJECT_ADDITIONAL_PROPERTIES: \"Additional properties not allowed\",\r\n\tOBJECT_DEPENDENCY_KEY: \"Dependency failed - key must exist: {missing} (due to key: {key})\",\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: \"Array is too short ({length}), minimum {minimum}\",\r\n\tARRAY_LENGTH_LONG: \"Array is too long ({length}), maximum {maximum}\",\r\n\tARRAY_UNIQUE: \"Array items are not unique (indices {match1} and {match2})\",\r\n\tARRAY_ADDITIONAL_ITEMS: \"Additional items not allowed\",\r\n\t// Format errors\r\n\tFORMAT_CUSTOM: \"Format validation failed ({message})\",\r\n\tKEYWORD_CUSTOM: \"Keyword failed: {key} ({message})\",\r\n\t// Schema structure\r\n\tCIRCULAR_REFERENCE: \"Circular $refs: {urls}\",\r\n\t// Non-standard validation options\r\n\tUNKNOWN_PROPERTY: \"Unknown property (not in schema)\"\r\n};\r\n\r\nfunction ValidationError(code, params, dataPath, schemaPath, subErrors) {\r\n\tError.call(this);\r\n\tif (code === undefined) {\r\n\t\tthrow new Error (\"No error code supplied: \" + schemaPath);\r\n\t}\r\n\tthis.message = '';\r\n\tthis.params = params;\r\n\tthis.code = code;\r\n\tthis.dataPath = dataPath || \"\";\r\n\tthis.schemaPath = schemaPath || \"\";\r\n\tthis.subErrors = subErrors || null;\r\n\r\n\tvar err = new Error(this.message);\r\n\tthis.stack = err.stack || err.stacktrace;\r\n\tif (!this.stack) {\r\n\t\ttry {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t\tcatch(err) {\r\n\t\t\tthis.stack = err.stack || err.stacktrace;\r\n\t\t}\r\n\t}\r\n}\r\nValidationError.prototype = Object.create(Error.prototype);\r\nValidationError.prototype.constructor = ValidationError;\r\nValidationError.prototype.name = 'ValidationError';\r\n\r\nValidationError.prototype.prefixWith = function (dataPrefix, schemaPrefix) {\r\n\tif (dataPrefix !== null) {\r\n\t\tdataPrefix = dataPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\r\n\t\tthis.dataPath = \"/\" + dataPrefix + this.dataPath;\r\n\t}\r\n\tif (schemaPrefix !== null) {\r\n\t\tschemaPrefix = schemaPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\r\n\t\tthis.schemaPath = \"/\" + schemaPrefix + this.schemaPath;\r\n\t}\r\n\tif (this.subErrors !== null) {\r\n\t\tfor (var i = 0; i < this.subErrors.length; i++) {\r\n\t\t\tthis.subErrors[i].prefixWith(dataPrefix, schemaPrefix);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nfunction isTrustedUrl(baseUrl, testUrl) {\r\n\tif(testUrl.substring(0, baseUrl.length) === baseUrl){\r\n\t\tvar remainder = testUrl.substring(baseUrl.length);\r\n\t\tif ((testUrl.length > 0 && testUrl.charAt(baseUrl.length - 1) === \"/\")\r\n\t\t\t|| remainder.charAt(0) === \"#\"\r\n\t\t\t|| remainder.charAt(0) === \"?\") {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nvar languages = {};\r\nfunction createApi(language) {\r\n\tvar globalContext = new ValidatorContext();\r\n\tvar currentLanguage;\r\n\tvar customErrorReporter;\r\n\tvar api = {\r\n\t\tsetErrorReporter: function (reporter) {\r\n\t\t\tif (typeof reporter === 'string') {\r\n\t\t\t\treturn this.language(reporter);\r\n\t\t\t}\r\n\t\t\tcustomErrorReporter = reporter;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\taddFormat: function () {\r\n\t\t\tglobalContext.addFormat.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tlanguage: function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\treturn currentLanguage;\r\n\t\t\t}\r\n\t\t\tif (!languages[code]) {\r\n\t\t\t\tcode = code.split('-')[0]; // fall back to base language\r\n\t\t\t}\r\n\t\t\tif (languages[code]) {\r\n\t\t\t\tcurrentLanguage = code;\r\n\t\t\t\treturn code; // so you can tell if fall-back has happened\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\taddLanguage: function (code, messageMap) {\r\n\t\t\tvar key;\r\n\t\t\tfor (key in ErrorCodes) {\r\n\t\t\t\tif (messageMap[key] && !messageMap[ErrorCodes[key]]) {\r\n\t\t\t\t\tmessageMap[ErrorCodes[key]] = messageMap[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar rootCode = code.split('-')[0];\r\n\t\t\tif (!languages[rootCode]) { // use for base language if not yet defined\r\n\t\t\t\tlanguages[code] = messageMap;\r\n\t\t\t\tlanguages[rootCode] = messageMap;\r\n\t\t\t} else {\r\n\t\t\t\tlanguages[code] = Object.create(languages[rootCode]);\r\n\t\t\t\tfor (key in messageMap) {\r\n\t\t\t\t\tif (typeof languages[rootCode][key] === 'undefined') {\r\n\t\t\t\t\t\tlanguages[rootCode][key] = messageMap[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlanguages[code][key] = messageMap[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tfreshApi: function (language) {\r\n\t\t\tvar result = createApi();\r\n\t\t\tif (language) {\r\n\t\t\t\tresult.language(language);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tvalidate: function (data, schema, checkRecursive, banUnknownProperties) {\r\n\t\t\tvar def = defaultErrorReporter(currentLanguage);\r\n\t\t\tvar errorReporter = customErrorReporter ? function (error, data, schema) {\r\n\t\t\t\treturn customErrorReporter(error, data, schema) || def(error, data, schema);\r\n\t\t\t} : def;\r\n\t\t\tvar context = new ValidatorContext(globalContext, false, errorReporter, checkRecursive, banUnknownProperties);\r\n\t\t\tif (typeof schema === \"string\") {\r\n\t\t\t\tschema = {\"$ref\": schema};\r\n\t\t\t}\r\n\t\t\tcontext.addSchema(\"\", schema);\r\n\t\t\tvar error = context.validateAll(data, schema, null, null, \"\");\r\n\t\t\tif (!error && banUnknownProperties) {\r\n\t\t\t\terror = context.banUnknownProperties(data, schema);\r\n\t\t\t}\r\n\t\t\tthis.error = error;\r\n\t\t\tthis.missing = context.missing;\r\n\t\t\tthis.valid = (error === null);\r\n\t\t\treturn this.valid;\r\n\t\t},\r\n\t\tvalidateResult: function () {\r\n\t\t\tvar result = {toString: function () {\r\n\t\t\t\treturn this.valid ? 'valid' : this.error.message;\r\n\t\t\t}};\r\n\t\t\tthis.validate.apply(result, arguments);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tvalidateMultiple: function (data, schema, checkRecursive, banUnknownProperties) {\r\n\t\t\tvar def = defaultErrorReporter(currentLanguage);\r\n\t\t\tvar errorReporter = customErrorReporter ? function (error, data, schema) {\r\n\t\t\t\treturn customErrorReporter(error, data, schema) || def(error, data, schema);\r\n\t\t\t} : def;\r\n\t\t\tvar context = new ValidatorContext(globalContext, true, errorReporter, checkRecursive, banUnknownProperties);\r\n\t\t\tif (typeof schema === \"string\") {\r\n\t\t\t\tschema = {\"$ref\": schema};\r\n\t\t\t}\r\n\t\t\tcontext.addSchema(\"\", schema);\r\n\t\t\tcontext.validateAll(data, schema, null, null, \"\");\r\n\t\t\tif (banUnknownProperties) {\r\n\t\t\t\tcontext.banUnknownProperties(data, schema);\r\n\t\t\t}\r\n\t\t\tvar result = {toString: function () {\r\n\t\t\t\treturn this.valid ? 'valid' : this.error.message;\r\n\t\t\t}};\r\n\t\t\tresult.errors = context.errors;\r\n\t\t\tresult.missing = context.missing;\r\n\t\t\tresult.valid = (result.errors.length === 0);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\taddSchema: function () {\r\n\t\t\treturn globalContext.addSchema.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchema: function () {\r\n\t\t\treturn globalContext.getSchema.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchemaMap: function () {\r\n\t\t\treturn globalContext.getSchemaMap.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchemaUris: function () {\r\n\t\t\treturn globalContext.getSchemaUris.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetMissingUris: function () {\r\n\t\t\treturn globalContext.getMissingUris.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdropSchemas: function () {\r\n\t\t\tglobalContext.dropSchemas.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdefineKeyword: function () {\r\n\t\t\tglobalContext.defineKeyword.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdefineError: function (codeName, codeNumber, defaultMessage) {\r\n\t\t\tif (typeof codeName !== 'string' || !/^[A-Z]+(_[A-Z]+)*$/.test(codeName)) {\r\n\t\t\t\tthrow new Error('Code name must be a string in UPPER_CASE_WITH_UNDERSCORES');\r\n\t\t\t}\r\n\t\t\tif (typeof codeNumber !== 'number' || codeNumber%1 !== 0 || codeNumber < 10000) {\r\n\t\t\t\tthrow new Error('Code number must be an integer > 10000');\r\n\t\t\t}\r\n\t\t\tif (typeof ErrorCodes[codeName] !== 'undefined') {\r\n\t\t\t\tthrow new Error('Error already defined: ' + codeName + ' as ' + ErrorCodes[codeName]);\r\n\t\t\t}\r\n\t\t\tif (typeof ErrorCodeLookup[codeNumber] !== 'undefined') {\r\n\t\t\t\tthrow new Error('Error code already used: ' + ErrorCodeLookup[codeNumber] + ' as ' + codeNumber);\r\n\t\t\t}\r\n\t\t\tErrorCodes[codeName] = codeNumber;\r\n\t\t\tErrorCodeLookup[codeNumber] = codeName;\r\n\t\t\tErrorMessagesDefault[codeName] = ErrorMessagesDefault[codeNumber] = defaultMessage;\r\n\t\t\tfor (var langCode in languages) {\r\n\t\t\t\tvar language = languages[langCode];\r\n\t\t\t\tif (language[codeName]) {\r\n\t\t\t\t\tlanguage[codeNumber] = language[codeNumber] || language[codeName];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treset: function () {\r\n\t\t\tglobalContext.reset();\r\n\t\t\tthis.error = null;\r\n\t\t\tthis.missing = [];\r\n\t\t\tthis.valid = true;\r\n\t\t},\r\n\t\tmissing: [],\r\n\t\terror: null,\r\n\t\tvalid: true,\r\n\t\tnormSchema: normSchema,\r\n\t\tresolveUrl: resolveUrl,\r\n\t\tgetDocumentUri: getDocumentUri,\r\n\t\terrorCodes: ErrorCodes\r\n\t};\r\n\tapi.language(language || 'en');\r\n\treturn api;\r\n}\r\n\r\nvar tv4 = createApi();\r\ntv4.addLanguage('en-gb', ErrorMessagesDefault);\r\n\r\n//legacy property\r\ntv4.tv4 = tv4;\r\n\r\nreturn tv4; // used by _header.js to globalise.\r\n\r\n}));"]},"metadata":{},"sourceType":"script"}